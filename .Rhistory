nchar(PP04D_COD) == 2 ~ paste0("000", PP04D_COD),
nchar(PP04D_COD) == 1 ~ paste0("0000", PP04D_COD)),
CALIFICACION = substr(PP04D_COD, 5, 5),
CALIFICACION = case_when(CALIFICACION=="1" ~ "Profesionales",
CALIFICACION=="2" ~ "Técnicos",
CALIFICACION=="3" ~ "Operativos",
CALIFICACION=="4" ~ "No Calificados"),
CALIFICACION = factor(CALIFICACION, c("No Calificados", "Operativos", "Técnicos", "Profesionales")),
TIPOCALIFICACION= case_when(CALIFICACION=="Profesionales" | CALIFICACION== "Técnicos" ~ "Calificado",
CALIFICACION=="No Calificados" | CALIFICACION=="Operativos" ~ "No calificado"),
SEXO= case_when(CH04==1 ~ "Hombres",
CH04==2 ~ "Mujeres"),
horastrabtotales= PP3E_TOT + PP3F_TOT)
#EPH fusionada
ephtotalsd <- ephtotalsd %>%  mutate(PEA= case_when(ESTADO==3 ~ 0,
ESTADO==4 ~ 0,
ESTADO==1 ~ 1,
ESTADO==2 ~ 1),
OCUPADOS= case_when(ESTADO==1 ~ 1,
ESTADO==2 ~ 0,
ESTADO==3 ~ 0,
ESTADO==4 ~ 0),
DESOCUPADOS= case_when(ESTADO==1 ~ 0,
ESTADO==2 ~ 1),
EMPLEADOS= case_when(PP04A==1 ~ "Empleados Publicos",
PP04A==2 ~ "Empleados privados",
PP04A==3 ~ "Otros",
TRUE ~ NA_character_),
PP04B_COD=as.character(PP04B_COD),
PP04B_COD=case_when(nchar(PP04B_COD)==4~PP04B_COD,
nchar(PP04B_COD)==1~ paste0("0",PP04B_COD,"00"),
nchar(PP04B_COD)==2~ paste0(PP04B_COD,"00"),
nchar(PP04B_COD)==3~ paste0("0",PP04B_COD)),
SECTOR= substr(PP04B_COD,1,2),
INFORMALES=case_when( CAT_OCUP==3 & PP07H==2 ~ 1,
CAT_OCUP==3 & PP07H==1 ~ 0),
PP04D_COD = as.character(PP04D_COD),
PP04D_COD = case_when(nchar(PP04D_COD) == 5 ~ PP04D_COD,
nchar(PP04D_COD) == 4 ~ paste0("0", PP04D_COD),
nchar(PP04D_COD) == 3 ~ paste0("00", PP04D_COD),
nchar(PP04D_COD) == 2 ~ paste0("000", PP04D_COD),
nchar(PP04D_COD) == 1 ~ paste0("0000", PP04D_COD)),
CALIFICACION = substr(PP04D_COD, 5, 5),
CALIFICACION = case_when(CALIFICACION=="1" ~ "Profesionales",
CALIFICACION=="2" ~ "Técnicos",
CALIFICACION=="3" ~ "Operativos",
CALIFICACION=="4" ~ "No Calificados"),
CALIFICACION = factor(CALIFICACION, c("No Calificados", "Operativos", "Técnicos", "Profesionales")),
TIPOCALIFICACION= case_when(CALIFICACION=="Profesionales" | CALIFICACION== "Técnicos" ~ "Calificado",
CALIFICACION=="No Calificados" | CALIFICACION=="Operativos" ~ "No calificado"))
sectores_eph1t<- left_join(eph1t,caes)
sectores_ephtotal<- left_join(ephtotalsd,caes)
Edad <- c("0-14", "15-24", "25-34", "35-44", "45-59", "Mayor o igual a 60")
Hombres <- c(0.28, 0.21, 0.16, 0.11, 0.15, 0.09)
Mujeres <- c(0.25, 0.20, 0.16, 0.12, 0.15, 0.12)
poblacion <- data.frame(Edad, Hombres, Mujeres)
#Tabla
tabla_1<- poblacion %>%
mutate(Hombres=formattable::percent(Hombres), Mujeres=formattable::percent(Mujeres)) %>%
kbl(booktabs = T) %>%
kable_styling(latex_options = c("striped", "hover", "condensed"), font_size = 18, position = "center") %>%
row_spec(0, color = "white", bold = TRUE, background="#29aee4", font_size = 22) %>%
row_spec(seq(1,nrow(poblacion),2), background="#F0FFFF") %>%
column_spec(1, width = "18em") %>%
column_spec(2, width = "14em") %>%
column_spec(3, width = "14em")
kableExtra::save_kable(tabla_1,"./graficos_md/tabla_1.jpg")
#svg(filename = 'tabla_1.pdf')
#Tabla
tabla_1<- poblacion %>%
mutate(Hombres=formattable::percent(Hombres), Mujeres=formattable::percent(Mujeres)) %>%
kbl(booktabs = T) %>%
kable_styling(latex_options = c("striped", "hover", "condensed"), font_size = 18, position = "center") %>%
row_spec(0, color = "white", bold = TRUE, background="#29aee4", font_size = 22) %>%
row_spec(seq(1,nrow(poblacion),2), background="#F0FFFF") %>%
column_spec(1, width = "18em") %>%
column_spec(2, width = "14em") %>%
column_spec(3, width = "14em")
kableExtra::save_kable(tabla_1,"./graficos_md/tabla_1.jpg")
#svg(filename = 'tabla_1.pdf')
#Tabla
tabla_1<- poblacion %>%
mutate(Hombres=formattable::percent(Hombres), Mujeres=formattable::percent(Mujeres)) %>%
kbl(booktabs = T) %>%
kable_styling(latex_options = c("striped", "hover", "condensed"), font_size = 18, position = "center") %>%
row_spec(0, color = "white", bold = TRUE, background="#29aee4", font_size = 22) %>%
row_spec(seq(1,nrow(poblacion),2), background="#F0FFFF") %>%
column_spec(1, width = "18em") %>%
column_spec(2, width = "14em") %>%
column_spec(3, width = "14em")
kableExtra::save_kable(tabla_1,"./graficos_md/tabla_1.jpg")
#svg(filename = 'tabla_1.pdf')
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, dev = "cairo_pdf")
grafico2 <- nivelalcanzado %>% ggplot() + geom_chicklet(aes(x=Nivel, y=porcentaje, fill=Sexo), position = position_dodge(), width = 0.7, show.legend = F) +
geom_point(aes(x=Nivel, y=Brecha), shape=15, color="#e7930b") +
geom_line(aes(x=Nivel, y=Brecha, group = 1), color="#f4a018", size=1.) +
scale_y_continuous(labels = percent, limits = c(0,1)) + scale_fill_manual(values=colores) +
labs(title ="Participación laboral según nivel educativo para <span style = 'color: #29aee4;'>**hombres**</span>, <span style='color: #0c8136;'>**mujeres**</span> \n y <span style = 'color: #f4a018;'>**brecha**</span>", subtitle = "Primer trimestre 2021", x = "Nivel alcanzado", y="Tasa de participación laboral") +
theme(text = element_text(family = "Open Sans"), plot.title = element_markdown(size = 14), plot.title.position = "plot", plot.subtitle = element_text(size = 8), axis.title = element_text(size=8), legend.position = "bottom", legend.text = element_text(size = 8), legend.title = element_text(), axis.text = element_text(colour = "BLACK", family="Open Sans", size = 7), panel.background = element_blank(), panel.grid.major = element_blank())
#Primero se cargan las librerías, fuentes y gama de colores que se utilizaran para el informe
#Librerias
library(ggtext)
library(eph)
library(tidyverse)
library(formattable)
library(Hmisc)
library(readxl)
library(foreign)
library(glue)
library(extrafont)
library(ggalt)
library(waffle)
library(Rcpp)
library(ggimage)
library(spatstat)
library(splitstackshape)
library(purrr)
library(treemapify)
library(scales)
library(forcats)
library(svglite)
library(ggchicklet)
library(ggpubr)
library(kableExtra)
#Fuente
font_import(paths = "./Open_Sans", prompt = F)
loadfonts(device = "win", quiet=T)
#Colores
colores<- c("#29aee4","#0c8136","#e22172","#f4a018","#428cb4","#c85687","#dbac2f","#5da14a","#ff9a00")
gradiente<- c("#ed3068","#ef4275","#f3789d","#f69cb7","#fbd2de")
#Se cargan las bases de datos
#Primer trimestre 2021
eph1ti<- get_microdata(year=2021, trimester=1, type="individual")
eph1tih <- get_microdata(year=2021, trimester=1, type="hogar")
eph1t <- left_join(eph1ti, eph1tih)
#Para mas adelante se necesitarán los datos del trimestre anterior, por lo que se procede a cargar la correspondiente base
#Cuartro trimestre 2020
ephi<- get_microdata(year=2020, trimester=4, type="individual")
ephh <- get_microdata(year=2020, trimester=4, type="hogar")
eph4t <- left_join(ephi, ephh)
#Se realiza un merge de ambas bases
ephtotal <- bind_rows(eph1t, eph4t)
ephtotalsd <- ephtotal %>% distinct(., CODUSU, NRO_HOGAR, COMPONENTE, .keep_all = T)
#CAES
caes<- read.csv("SECTORESCAES.csv", sep = ";", colClasses = "character")
#Modificaciones a la EPH
#Primer trimestre 2021
eph1t <- eph1t %>%  mutate(PEA= case_when(ESTADO==3 ~ 0,
ESTADO==4 ~ 0,
ESTADO==1 ~ 1,
ESTADO==2 ~ 1),
OCUPADOS= case_when(ESTADO==1 ~ 1,
ESTADO==2 ~ 0,
ESTADO==3 ~ 0,
ESTADO==4 ~ 0),
DESOCUPADOS= case_when(ESTADO==1 ~ 0,
ESTADO==2 ~ 1),
EMPLEADOS= case_when(PP04A==1 ~ "Empleados Publicos",
PP04A==2 ~ "Empleados privados",
PP04A==3 ~ "Otros",
TRUE ~ NA_character_),
PP04B_COD=as.character(PP04B_COD),
PP04B_COD=case_when(nchar(PP04B_COD)==4~PP04B_COD,
nchar(PP04B_COD)==1~ paste0("0",PP04B_COD,"00"),
nchar(PP04B_COD)==2~ paste0(PP04B_COD,"00"),
nchar(PP04B_COD)==3~ paste0("0",PP04B_COD)),
SECTOR= substr(PP04B_COD,1,2),
INFORMALES=case_when( CAT_OCUP==3 & PP07H==2 ~ 1,
CAT_OCUP==3 & PP07H==1 ~ 0),
PP04D_COD = as.character(PP04D_COD),
PP04D_COD = case_when(nchar(PP04D_COD) == 5 ~ PP04D_COD,
nchar(PP04D_COD) == 4 ~ paste0("0", PP04D_COD),
nchar(PP04D_COD) == 3 ~ paste0("00", PP04D_COD),
nchar(PP04D_COD) == 2 ~ paste0("000", PP04D_COD),
nchar(PP04D_COD) == 1 ~ paste0("0000", PP04D_COD)),
CALIFICACION = substr(PP04D_COD, 5, 5),
CALIFICACION = case_when(CALIFICACION=="1" ~ "Profesionales",
CALIFICACION=="2" ~ "Técnicos",
CALIFICACION=="3" ~ "Operativos",
CALIFICACION=="4" ~ "No Calificados"),
CALIFICACION = factor(CALIFICACION, c("No Calificados", "Operativos", "Técnicos", "Profesionales")),
TIPOCALIFICACION= case_when(CALIFICACION=="Profesionales" | CALIFICACION== "Técnicos" ~ "Calificado",
CALIFICACION=="No Calificados" | CALIFICACION=="Operativos" ~ "No calificado"),
SEXO= case_when(CH04==1 ~ "Hombres",
CH04==2 ~ "Mujeres"),
horastrabtotales= PP3E_TOT + PP3F_TOT)
#EPH fusionada
ephtotalsd <- ephtotalsd %>%  mutate(PEA= case_when(ESTADO==3 ~ 0,
ESTADO==4 ~ 0,
ESTADO==1 ~ 1,
ESTADO==2 ~ 1),
OCUPADOS= case_when(ESTADO==1 ~ 1,
ESTADO==2 ~ 0,
ESTADO==3 ~ 0,
ESTADO==4 ~ 0),
DESOCUPADOS= case_when(ESTADO==1 ~ 0,
ESTADO==2 ~ 1),
EMPLEADOS= case_when(PP04A==1 ~ "Empleados Publicos",
PP04A==2 ~ "Empleados privados",
PP04A==3 ~ "Otros",
TRUE ~ NA_character_),
PP04B_COD=as.character(PP04B_COD),
PP04B_COD=case_when(nchar(PP04B_COD)==4~PP04B_COD,
nchar(PP04B_COD)==1~ paste0("0",PP04B_COD,"00"),
nchar(PP04B_COD)==2~ paste0(PP04B_COD,"00"),
nchar(PP04B_COD)==3~ paste0("0",PP04B_COD)),
SECTOR= substr(PP04B_COD,1,2),
INFORMALES=case_when( CAT_OCUP==3 & PP07H==2 ~ 1,
CAT_OCUP==3 & PP07H==1 ~ 0),
PP04D_COD = as.character(PP04D_COD),
PP04D_COD = case_when(nchar(PP04D_COD) == 5 ~ PP04D_COD,
nchar(PP04D_COD) == 4 ~ paste0("0", PP04D_COD),
nchar(PP04D_COD) == 3 ~ paste0("00", PP04D_COD),
nchar(PP04D_COD) == 2 ~ paste0("000", PP04D_COD),
nchar(PP04D_COD) == 1 ~ paste0("0000", PP04D_COD)),
CALIFICACION = substr(PP04D_COD, 5, 5),
CALIFICACION = case_when(CALIFICACION=="1" ~ "Profesionales",
CALIFICACION=="2" ~ "Técnicos",
CALIFICACION=="3" ~ "Operativos",
CALIFICACION=="4" ~ "No Calificados"),
CALIFICACION = factor(CALIFICACION, c("No Calificados", "Operativos", "Técnicos", "Profesionales")),
TIPOCALIFICACION= case_when(CALIFICACION=="Profesionales" | CALIFICACION== "Técnicos" ~ "Calificado",
CALIFICACION=="No Calificados" | CALIFICACION=="Operativos" ~ "No calificado"))
sectores_eph1t<- left_join(eph1t,caes)
sectores_ephtotal<- left_join(ephtotalsd,caes)
grafico2 <- nivelalcanzado %>% ggplot() + geom_chicklet(aes(x=Nivel, y=porcentaje, fill=Sexo), position = position_dodge(), width = 0.7, show.legend = F) +
geom_point(aes(x=Nivel, y=Brecha), shape=15, color="#e7930b") +
geom_line(aes(x=Nivel, y=Brecha, group = 1), color="#f4a018", size=1.) +
scale_y_continuous(labels = percent, limits = c(0,1)) + scale_fill_manual(values=colores) +
labs(title ="Participación laboral según nivel educativo para <span style = 'color: #29aee4;'>**hombres**</span>, <span style='color: #0c8136;'>**mujeres**</span> \n y <span style = 'color: #f4a018;'>**brecha**</span>", subtitle = "Primer trimestre 2021", x = "Nivel alcanzado", y="Tasa de participación laboral") +
theme(text = element_text(family = "Open Sans"), plot.title = element_markdown(size = 14), plot.title.position = "plot", plot.subtitle = element_text(size = 8), axis.title = element_text(size=8), legend.position = "bottom", legend.text = element_text(size = 8), legend.title = element_text(), axis.text = element_text(colour = "BLACK", family="Open Sans", size = 7), panel.background = element_blank(), panel.grid.major = element_blank())
### Tasa de participación laboral por sexo y nivel educativo
#Primaria completa
#Hombres:
hombresprim <- eph1t %>%  filter(CH04==1 & AGLOMERADO==12 & ESTADO!=0 & NIVEL_ED %in% c(2,3))
hombresprim <- hombresprim %>% group_by(PEA) %>% summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresprim$PONDERA)),2), Sexo="Hombres", Nivel="Primaria Completa") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres:
mujeresprim <- eph1t %>%  filter(CH04==2 & AGLOMERADO==12 & ESTADO!=0 & NIVEL_ED %in% c(2,3))
mujeresprim <- mujeresprim %>% group_by(PEA) %>% summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeresprim$PONDERA)),2), Sexo="Mujeres", Nivel="Primaria Completa") %>% filter(PEA==1) %>% select(-PEA)
primariacomp <- bind_rows(hombresprim, mujeresprim) %>% mutate("Brecha"=formattable::percent((0.4848-0.2125)))
#Secundaria completa
#Hombres:
hombressec <- eph1t %>% filter(CH04==1 & AGLOMERADO==12 & ESTADO!=0 & NIVEL_ED %in% c(4,5))
hombressec <- hombressec %>% group_by(PEA) %>% summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombressec$PONDERA)),2), Sexo="Hombres", Nivel="Secundaria Completa") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres:
mujeressec <- eph1t %>%  filter(CH04==2 & AGLOMERADO==12 & ESTADO!=0 & NIVEL_ED %in% c(4,5))
mujeressec <- mujeressec %>% group_by(PEA) %>% summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeressec$PONDERA)),2), Sexo="Mujeres", Nivel="Secundaria Completa") %>% filter(PEA==1) %>% select(-PEA)
secundariacomp <- bind_rows(hombressec, mujeressec) %>% mutate("Brecha"=formattable::percent((0.6582-0.5618)))
#Superior completo
#Hombres:
hombressup <- eph1t %>%  filter(CH04==1 & AGLOMERADO==12 & ESTADO!=0 & NIVEL_ED==6)
hombressup <- hombressup %>% group_by(PEA) %>% summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombressup$PONDERA)),2), Sexo="Hombres", Nivel="Superior Completo") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres:
mujeressup <- eph1t %>%  filter(CH04==2 & AGLOMERADO==12 & ESTADO!=0 & NIVEL_ED==6)
mujeressup <- mujeressup %>% group_by(PEA) %>% summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeressup$PONDERA)),2), Sexo="Mujeres", Nivel="Superior Completo") %>% filter(PEA==1) %>% select(-PEA)
superiorcomp <- bind_rows(hombressup, mujeressup) %>% mutate("Brecha"=formattable::percent((0.8388-0.7390)))
nivelalcanzado <- bind_rows(primariacomp, secundariacomp, superiorcomp)
grafico2 <- nivelalcanzado %>% ggplot() + geom_chicklet(aes(x=Nivel, y=porcentaje, fill=Sexo), position = position_dodge(), width = 0.7, show.legend = F) +
geom_point(aes(x=Nivel, y=Brecha), shape=15, color="#e7930b") +
geom_line(aes(x=Nivel, y=Brecha, group = 1), color="#f4a018", size=1.) +
scale_y_continuous(labels = percent, limits = c(0,1)) + scale_fill_manual(values=colores) +
labs(title ="Participación laboral según nivel educativo para <span style = 'color: #29aee4;'>**hombres**</span>, <span style='color: #0c8136;'>**mujeres**</span> \n y <span style = 'color: #f4a018;'>**brecha**</span>", subtitle = "Primer trimestre 2021", x = "Nivel alcanzado", y="Tasa de participación laboral") +
theme(text = element_text(family = "Open Sans"), plot.title = element_markdown(size = 14), plot.title.position = "plot", plot.subtitle = element_text(size = 8), axis.title = element_text(size=8), legend.position = "bottom", legend.text = element_text(size = 8), legend.title = element_text(), axis.text = element_text(colour = "BLACK", family="Open Sans", size = 7), panel.background = element_blank(), panel.grid.major = element_blank())
grafico2
ggsave("grafico2.svg")
grafico2 <- nivelalcanzado %>% ggplot() + geom_chicklet(aes(x=Nivel, y=porcentaje, fill=Sexo), position = position_dodge(), width = 0.7, show.legend = F) +
geom_point(aes(x=Nivel, y=Brecha), shape=15, color="#e7930b") +
geom_line(aes(x=Nivel, y=Brecha, group = 1), color="#f4a018", size=1.) +
scale_y_continuous(labels = percent, limits = c(0,1)) + scale_fill_manual(values=colores) +
labs(title ="Participación laboral según nivel educativo para <span style = 'color: #29aee4;'>**hombres**</span>, <span style='color: #0c8136;'>**mujeres**</span> \ny <span style = 'color: #f4a018;'>**brecha**</span>", subtitle = "Primer trimestre 2021", x = "Nivel alcanzado", y="Tasa de participación laboral") +
theme(text = element_text(family = "Open Sans"), plot.title = element_markdown(size = 14), plot.title.position = "plot", plot.subtitle = element_text(size = 8), axis.title = element_text(size=8), legend.position = "bottom", legend.text = element_text(size = 8), legend.title = element_text(), axis.text = element_text(colour = "BLACK", family="Open Sans", size = 7), panel.background = element_blank(), panel.grid.major = element_blank())
grafico2
ggsave("grafico2.svg")
grafico2 <- nivelalcanzado %>% ggplot() + geom_chicklet(aes(x=Nivel, y=porcentaje, fill=Sexo), position = position_dodge(), width = 0.7, show.legend = F) +
geom_point(aes(x=Nivel, y=Brecha), shape=15, color="#e7930b") +
geom_line(aes(x=Nivel, y=Brecha, group = 1), color="#f4a018", size=1.) +
scale_y_continuous(labels = percent, limits = c(0,1)) + scale_fill_manual(values=colores) +
labs(title ="Participación laboral según nivel educativo para <span style = 'color: #29aee4;'>**hombres**</span>, <span style='color: #0c8136;'>**mujeres**</span> y\n <span style = 'color: #f4a018;'>**brecha**</span>", subtitle = "Primer trimestre 2021", x = "Nivel alcanzado", y="Tasa de participación laboral") +
theme(text = element_text(family = "Open Sans"), plot.title = element_markdown(size = 14), plot.title.position = "plot", plot.subtitle = element_text(size = 8), axis.title = element_text(size=8), legend.position = "bottom", legend.text = element_text(size = 8), legend.title = element_text(), axis.text = element_text(colour = "BLACK", family="Open Sans", size = 7), panel.background = element_blank(), panel.grid.major = element_blank())
grafico2
ggsave("grafico2.svg")
grafico2 <- nivelalcanzado %>% ggplot() + geom_chicklet(aes(x=Nivel, y=porcentaje, fill=Sexo), position = position_dodge(), width = 0.7, show.legend = F) +
geom_point(aes(x=Nivel, y=Brecha), shape=15, color="#e7930b") +
geom_line(aes(x=Nivel, y=Brecha, group = 1), color="#f4a018", size=1.) +
scale_y_continuous(labels = percent, limits = c(0,1)) + scale_fill_manual(values=colores) +
labs(title ="Participación laboral según nivel educativo para <span style = 'color: #29aee4;'>**hombres**</span>, <span style='color: #0c8136;'>**mujeres**</span> y \n <span style = 'color: #f4a018;'>**brecha**</span>", subtitle = "Primer trimestre 2021", x = "Nivel alcanzado", y="Tasa de participación laboral") +
theme(text = element_text(family = "Open Sans"), plot.title = element_markdown(size = 14), plot.title.position = "plot", plot.subtitle = element_text(size = 8), axis.title = element_text(size=8), legend.position = "bottom", legend.text = element_text(size = 8), legend.title = element_text(), axis.text = element_text(colour = "BLACK", family="Open Sans", size = 7), panel.background = element_blank(), panel.grid.major = element_blank())
grafico2
ggsave("grafico2.svg")
grafico2 <- nivelalcanzado %>% ggplot() + geom_chicklet(aes(x=Nivel, y=porcentaje, fill=Sexo), position = position_dodge(), width = 0.7, show.legend = F) +
geom_point(aes(x=Nivel, y=Brecha), shape=15, color="#e7930b") +
geom_line(aes(x=Nivel, y=Brecha, group = 1), color="#f4a018", size=1.) +
scale_y_continuous(labels = percent, limits = c(0,1)) + scale_fill_manual(values=colores) +
labs(title ="Participación laboral según nivel educativo para <span style = 'color: #29aee4;'>**hombres**</span>, <span style='color: #0c8136;'>**mujeres**</span> y\n <span style = 'color: #f4a018;'>**brecha**</span>", subtitle = "Primer trimestre 2021", x = "Nivel alcanzado", y="Tasa de participación laboral") +
theme(text = element_text(family = "Open Sans"), plot.title = element_markdown(size = 14), plot.title.position = "plot", plot.subtitle = element_text(size = 8), axis.title = element_text(size=8), legend.position = "bottom", legend.text = element_text(size = 8), legend.title = element_text(), axis.text = element_text(colour = "BLACK", family="Open Sans", size = 7), panel.background = element_blank(), panel.grid.major = element_blank())
grafico2
ggsave("grafico2.svg")
grafico2 <- nivelalcanzado %>% ggplot() + geom_chicklet(aes(x=Nivel, y=porcentaje, fill=Sexo), position = position_dodge(), width = 0.7, show.legend = F) +
geom_point(aes(x=Nivel, y=Brecha), shape=15, color="#e7930b") +
geom_line(aes(x=Nivel, y=Brecha, group = 1), color="#f4a018", size=1.) +
scale_y_continuous(labels = percent, limits = c(0,1)) + scale_fill_manual(values=colores) +
labs(title ="Participación laboral según nivel educativo para <span style = 'color: #29aee4;'>**hombres**</span>, <span style='color: #0c8136;'>**mujeres**</span> \ny <span style = 'color: #f4a018;'>**brecha**</span>", subtitle = "Primer trimestre 2021", x = "Nivel alcanzado", y="Tasa de participación laboral") +
theme(text = element_text(family = "Open Sans"), plot.title = element_markdown(size = 14), plot.title.position = "plot", plot.subtitle = element_text(size = 8), axis.title = element_text(size=8), legend.position = "bottom", legend.text = element_text(size = 8), legend.title = element_text(), axis.text = element_text(colour = "BLACK", family="Open Sans", size = 7), panel.background = element_blank(), panel.grid.major = element_blank())
grafico2
ggsave("grafico2.svg")
grafico2 <- nivelalcanzado %>% ggplot() + geom_chicklet(aes(x=Nivel, y=porcentaje, fill=Sexo), position = position_dodge(), width = 0.7, show.legend = F) +
geom_point(aes(x=Nivel, y=Brecha), shape=15, color="#e7930b") +
geom_line(aes(x=Nivel, y=Brecha, group = 1), color="#f4a018", size=1.) +
scale_y_continuous(labels = percent, limits = c(0,1)) + scale_fill_manual(values=colores) +
labs(title ="Participación laboral según nivel educativo para <span style = 'color: #29aee4;'>**hombres**</span>, <span style='color: #0c8136;'>**mujeres**</span> /ny <span style = 'color: #f4a018;'>**brecha**</span>", subtitle = "Primer trimestre 2021", x = "Nivel alcanzado", y="Tasa de participación laboral") +
theme(text = element_text(family = "Open Sans"), plot.title = element_markdown(size = 14), plot.title.position = "plot", plot.subtitle = element_text(size = 8), axis.title = element_text(size=8), legend.position = "bottom", legend.text = element_text(size = 8), legend.title = element_text(), axis.text = element_text(colour = "BLACK", family="Open Sans", size = 7), panel.background = element_blank(), panel.grid.major = element_blank())
grafico2
ggsave("grafico2.svg")
grafico2 <- nivelalcanzado %>% ggplot() + geom_chicklet(aes(x=Nivel, y=porcentaje, fill=Sexo), position = position_dodge(), width = 0.7, show.legend = F) +
geom_point(aes(x=Nivel, y=Brecha), shape=15, color="#e7930b") +
geom_line(aes(x=Nivel, y=Brecha, group = 1), color="#f4a018", size=1.) +
scale_y_continuous(labels = percent, limits = c(0,1)) + scale_fill_manual(values=colores) +
labs(title ="Participación laboral según nivel educativo para <span style = 'color: #29aee4;'>**hombres**</span>, <span style='color: #0c8136;'>**mujeres**</span> <br>y <span style = 'color: #f4a018;'>**brecha**</span>", subtitle = "Primer trimestre 2021", x = "Nivel alcanzado", y="Tasa de participación laboral") +
theme(text = element_text(family = "Open Sans"), plot.title = element_markdown(size = 14), plot.title.position = "plot", plot.subtitle = element_text(size = 8), axis.title = element_text(size=8), legend.position = "bottom", legend.text = element_text(size = 8), legend.title = element_text(), axis.text = element_text(colour = "BLACK", family="Open Sans", size = 7), panel.background = element_blank(), panel.grid.major = element_blank())
grafico2
ggsave("grafico2.svg")
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, dev = "cairo_pdf")
#Primero se cargan las librerías, fuentes y gama de colores que se utilizaran para el informe
#Librerias
library(ggtext)
library(eph)
library(tidyverse)
library(formattable)
library(Hmisc)
library(readxl)
library(foreign)
library(glue)
library(extrafont)
library(ggalt)
library(waffle)
library(Rcpp)
library(ggimage)
library(spatstat)
library(splitstackshape)
library(purrr)
library(treemapify)
library(scales)
library(forcats)
library(svglite)
library(ggchicklet)
library(ggpubr)
library(kableExtra)
#Fuente
font_import(paths = "./Open_Sans", prompt = F)
loadfonts(device = "win", quiet=T)
#Colores
colores<- c("#29aee4","#0c8136","#e22172","#f4a018","#428cb4","#c85687","#dbac2f","#5da14a","#ff9a00")
gradiente<- c("#ed3068","#ef4275","#f3789d","#f69cb7","#fbd2de")
knitr::opts_chunk$set(echo = TRUE)
#Se cargan las bases de datos
#Primer trimestre 2021
eph1ti<- get_microdata(year=2021, trimester=1, type="individual")
eph1tih <- get_microdata(year=2021, trimester=1, type="hogar")
eph1t <- left_join(eph1ti, eph1tih)
#Para mas adelante se necesitarán los datos del trimestre anterior, por lo que se procede a cargar la correspondiente base
#Cuartro trimestre 2020
ephi<- get_microdata(year=2020, trimester=4, type="individual")
ephh <- get_microdata(year=2020, trimester=4, type="hogar")
eph4t <- left_join(ephi, ephh)
#Se realiza un merge de ambas bases
ephtotal <- bind_rows(eph1t, eph4t)
ephtotalsd <- ephtotal %>% distinct(., CODUSU, NRO_HOGAR, COMPONENTE, .keep_all = T)
#CAES
caes<- read.csv("SECTORESCAES.csv", sep = ";", colClasses = "character")
#Modificaciones a la EPH
#Primer trimestre 2021
eph1t <- eph1t %>%  mutate(PEA= case_when(ESTADO==3 ~ 0,
ESTADO==4 ~ 0,
ESTADO==1 ~ 1,
ESTADO==2 ~ 1),
OCUPADOS= case_when(ESTADO==1 ~ 1,
ESTADO==2 ~ 0,
ESTADO==3 ~ 0,
ESTADO==4 ~ 0),
DESOCUPADOS= case_when(ESTADO==1 ~ 0,
ESTADO==2 ~ 1),
EMPLEADOS= case_when(PP04A==1 ~ "Empleados Publicos",
PP04A==2 ~ "Empleados privados",
PP04A==3 ~ "Otros",
TRUE ~ NA_character_),
PP04B_COD=as.character(PP04B_COD),
PP04B_COD=case_when(nchar(PP04B_COD)==4~PP04B_COD,
nchar(PP04B_COD)==1~ paste0("0",PP04B_COD,"00"),
nchar(PP04B_COD)==2~ paste0(PP04B_COD,"00"),
nchar(PP04B_COD)==3~ paste0("0",PP04B_COD)),
SECTOR= substr(PP04B_COD,1,2),
INFORMALES=case_when( CAT_OCUP==3 & PP07H==2 ~ 1,
CAT_OCUP==3 & PP07H==1 ~ 0),
PP04D_COD = as.character(PP04D_COD),
PP04D_COD = case_when(nchar(PP04D_COD) == 5 ~ PP04D_COD,
nchar(PP04D_COD) == 4 ~ paste0("0", PP04D_COD),
nchar(PP04D_COD) == 3 ~ paste0("00", PP04D_COD),
nchar(PP04D_COD) == 2 ~ paste0("000", PP04D_COD),
nchar(PP04D_COD) == 1 ~ paste0("0000", PP04D_COD)),
CALIFICACION = substr(PP04D_COD, 5, 5),
CALIFICACION = case_when(CALIFICACION=="1" ~ "Profesionales",
CALIFICACION=="2" ~ "Técnicos",
CALIFICACION=="3" ~ "Operativos",
CALIFICACION=="4" ~ "No Calificados"),
CALIFICACION = factor(CALIFICACION, c("No Calificados", "Operativos", "Técnicos", "Profesionales")),
TIPOCALIFICACION= case_when(CALIFICACION=="Profesionales" | CALIFICACION== "Técnicos" ~ "Calificado",
CALIFICACION=="No Calificados" | CALIFICACION=="Operativos" ~ "No calificado"),
SEXO= case_when(CH04==1 ~ "Hombres",
CH04==2 ~ "Mujeres"),
horastrabtotales= PP3E_TOT + PP3F_TOT)
#EPH fusionada
ephtotalsd <- ephtotalsd %>%  mutate(PEA= case_when(ESTADO==3 ~ 0,
ESTADO==4 ~ 0,
ESTADO==1 ~ 1,
ESTADO==2 ~ 1),
OCUPADOS= case_when(ESTADO==1 ~ 1,
ESTADO==2 ~ 0,
ESTADO==3 ~ 0,
ESTADO==4 ~ 0),
DESOCUPADOS= case_when(ESTADO==1 ~ 0,
ESTADO==2 ~ 1),
EMPLEADOS= case_when(PP04A==1 ~ "Empleados Publicos",
PP04A==2 ~ "Empleados privados",
PP04A==3 ~ "Otros",
TRUE ~ NA_character_),
PP04B_COD=as.character(PP04B_COD),
PP04B_COD=case_when(nchar(PP04B_COD)==4~PP04B_COD,
nchar(PP04B_COD)==1~ paste0("0",PP04B_COD,"00"),
nchar(PP04B_COD)==2~ paste0(PP04B_COD,"00"),
nchar(PP04B_COD)==3~ paste0("0",PP04B_COD)),
SECTOR= substr(PP04B_COD,1,2),
INFORMALES=case_when( CAT_OCUP==3 & PP07H==2 ~ 1,
CAT_OCUP==3 & PP07H==1 ~ 0),
PP04D_COD = as.character(PP04D_COD),
PP04D_COD = case_when(nchar(PP04D_COD) == 5 ~ PP04D_COD,
nchar(PP04D_COD) == 4 ~ paste0("0", PP04D_COD),
nchar(PP04D_COD) == 3 ~ paste0("00", PP04D_COD),
nchar(PP04D_COD) == 2 ~ paste0("000", PP04D_COD),
nchar(PP04D_COD) == 1 ~ paste0("0000", PP04D_COD)),
CALIFICACION = substr(PP04D_COD, 5, 5),
CALIFICACION = case_when(CALIFICACION=="1" ~ "Profesionales",
CALIFICACION=="2" ~ "Técnicos",
CALIFICACION=="3" ~ "Operativos",
CALIFICACION=="4" ~ "No Calificados"),
CALIFICACION = factor(CALIFICACION, c("No Calificados", "Operativos", "Técnicos", "Profesionales")),
TIPOCALIFICACION= case_when(CALIFICACION=="Profesionales" | CALIFICACION== "Técnicos" ~ "Calificado",
CALIFICACION=="No Calificados" | CALIFICACION=="Operativos" ~ "No calificado"))
sectores_eph1t<- left_join(eph1t,caes)
sectores_ephtotal<- left_join(ephtotalsd,caes)
### Tasa de participación laboral por edad y sexo
#15 a 24 años
#Hombres
hombresact15 <- eph1t %>%  filter(CH04==1 & AGLOMERADO==12 & ESTADO!=0 & CH06<=24 & CH06>=15)
hombresact15 <- hombresact15 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact15$PONDERA)),2), Sexo="Hombres", Edad="15-24 años") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres
mujeresact15 <- eph1t %>%  filter(CH04==2 & AGLOMERADO==12 & ESTADO!=0 & CH06<=24 & CH06>=15)
mujeresact15 <- mujeresact15 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeresact15$PONDERA)),2), Sexo="Mujeres", Edad="15-24 años") %>% filter(PEA==1) %>% select(-PEA)
act15a24 <- bind_rows(hombresact15, mujeresact15)
#25 a 34 años
#Hombres
hombresact25 <- eph1t %>%  filter(CH04==1 & AGLOMERADO==12 & ESTADO!=0 & CH06<=34 & CH06>=25)
hombresact25 <- hombresact25 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact25$PONDERA)),2), Sexo="Hombres", Edad="25-34 años") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres
mujeresact25 <- eph1t %>%  filter(CH04==2 & AGLOMERADO==12 & ESTADO!=0 & CH06<=34 & CH06>=25)
mujeresact25 <- mujeresact25 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeresact25$PONDERA)),2), Sexo="Mujeres", Edad="25-34 años") %>% filter(PEA==1) %>% select(-PEA)
act25a34 <- bind_rows(hombresact25, mujeresact25)
#35 a 44 años
#Hombres
hombresact35 <- eph1t %>%  filter(CH04==1 & AGLOMERADO==12 & ESTADO!=0 & CH06<=44 & CH06>=35)
hombresact35 <- hombresact35 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact35$PONDERA)),2), Sexo="Hombres", Edad="35-44 años") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres
mujeresact35 <- eph1t %>%  filter(CH04==2 & AGLOMERADO==12 & ESTADO!=0 & CH06<=44 & CH06>=35)
mujeresact35 <- mujeresact35 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeresact35$PONDERA)),2), Sexo="Mujeres", Edad="35-44 años") %>% filter(PEA==1) %>% select(-PEA)
act35a44 <- bind_rows(hombresact35, mujeresact35)
#45 a 59 años
#Hombres
hombresact45 <- eph1t %>%  filter(CH04==1 & AGLOMERADO==12 & ESTADO!=0 & CH06<=59 & CH06>=45)
hombresact45 <- hombresact45 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact45$PONDERA)),2), Sexo="Hombres", Edad="45-59 años") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres
mujeresact45 <- eph1t %>%  filter(CH04==2 & AGLOMERADO==12 & ESTADO!=0 & CH06<=59 & CH06>=45)
mujeresact45 <- mujeresact45 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeresact45$PONDERA)),2), Sexo="Mujeres", Edad="45-59 años") %>% filter(PEA==1) %>% select(-PEA)
act45a59 <- bind_rows(hombresact45, mujeresact45)
#+60
#Hombres
hombresact60 <- eph1t %>%  filter(CH04==1 & AGLOMERADO==12 & ESTADO!=0 & CH06>=60)
hombresact60 <- hombresact60 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact60$PONDERA)),2), Sexo="Hombres", Edad="Igual o mayor a 60 años") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres
mujeresact60 <- eph1t %>%  filter(CH04==2 & AGLOMERADO==12 & ESTADO!=0 & CH06>=60)
mujeresact60 <- mujeresact60 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeresact60$PONDERA)),2), Sexo="Mujeres", Edad="Igual o mayor a 60 años") %>% filter(PEA==1) %>% select(-PEA)
act60 <- bind_rows(hombresact60, mujeresact60)
tabla_actividad <- bind_rows(act15a24, act25a34, act35a44, act45a59, act60)
tablakg_2 <- tabla_actividad %>% pivot_wider(names_from = Sexo, values_from = porcentaje)
