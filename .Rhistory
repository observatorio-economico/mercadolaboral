hombresact15 <- hombresact15 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact15$PONDERA)),2), Sexo="Hombres", Edad="15-24 años") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres
mujeresact15 <- edad15a24 %>%  filter(CH04==2)
mujeresact15 <- mujeresact15 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeresact15$PONDERA)),2), Sexo="Mujeres", Edad="15-24 años") %>% filter(PEA==1) %>% select(-PEA)
act15a24 <- bind_rows(hombresact15, mujeresact15)
#25 a 34 años
#Hombres
hombresact25 <- edad25a34 %>%  filter(CH04==1)
hombresact25 <- hombresact25 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact25$PONDERA)),2), Sexo="Hombres", Edad="25-34 años") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres
mujeresact25 <- edad25a34 %>%  filter(CH04==2)
mujeresact25 <- mujeresact25 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeresact25$PONDERA)),2), Sexo="Mujeres", Edad="25-34 años") %>% filter(PEA==1) %>% select(-PEA)
act25a34 <- bind_rows(hombresact25, mujeresact25)
#35 a 44 años
#Hombres
hombresact35 <- edad35a44 %>%  filter(CH04==1)
hombresact35 <- hombresact35 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact35$PONDERA)),2), Sexo="Hombres", Edad="35-44 años") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres
mujeresact35 <- edad35a44 %>%  filter(CH04==2)
mujeresact35 <- mujeresact35 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeresact35$PONDERA)),2), Sexo="Mujeres", Edad="35-44 años") %>% filter(PEA==1) %>% select(-PEA)
act35a44 <- bind_rows(hombresact35, mujeresact35)
#45 a 59 años
#Hombres
hombresact45 <- edad45a59 %>%  filter(CH04==1)
hombresact45 <- hombresact45 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact45$PONDERA)),2), Sexo="Hombres", Edad="45-59 años") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres
mujeresact45 <- edad45a59 %>%  filter(CH04==2)
mujeresact45 <- mujeresact45 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeresact45$PONDERA)),2), Sexo="Mujeres", Edad="45-59 años") %>% filter(PEA==1) %>% select(-PEA)
act45a59 <- bind_rows(hombresact45, mujeresact45)
#+60
#Hombres
hombresact60 <- edad60 %>%  filter(CH04==1)
hombresact60 <- hombresact60 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact60$PONDERA)),2), Sexo="Hombres", Edad="Igual o mayor a 60 años") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres
mujeresact60 <- edad60 %>%  filter(CH04==2)
mujeresact60 <- mujeresact60 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeresact60$PONDERA)),2), Sexo="Mujeres", Edad="Igual o mayor a 60 años") %>% filter(PEA==1) %>% select(-PEA)
act60 <- bind_rows(hombresact60, mujeresact60)
tabla_actividad <- bind_rows(act15a24, act25a34, act35a44, act45a59, act60)
tabla_actividad
grafico1 <- tabla_actividad %>% ggplot(mapping = aes(x=Edad, y=porcentaje, fill=Sexo)) +
geom_chicklet(position = position_dodge(width = 0.75), width=0.7, show.legend = F) +
scale_fill_manual(values=colores) + scale_y_continuous(labels = percent, limits = c(0,1)) +
labs(y = "Tasa de participación laboral", title ="Participación laboral por edad para <span style = 'color: #29aee4;'>**hombres**</span> y <span style='color: #0c8136;'>**mujeres**</span> ", subtitle ="Primer trimestre 2021", x = "") +
theme(text = element_text(family = "Open Sans"), plot.title = element_markdown(size = 14), plot.title.position = "plot", plot.subtitle = element_text(size = 8), axis.title = element_text(size=8), legend.position = "bottom", legend.text = element_text(size = 8), legend.title = element_blank(), axis.text = element_text(colour = "BLACK", family="Open Sans", size = 7), panel.background = element_blank(), panel.grid.major = element_blank())
#Fuente
font_import(paths = "./Open_Sans", prompt = F)
loadfonts(device = "win", quiet=T)
#Colores
colores<- c("#e22172","#0c8136","#e22172","#f4a018","#428cb4","#c85687","#dbac2f","#5da14a","#ff9a00")
gradiente<- c("#ed3068","#ef4275","#f3789d","#f69cb7","#fbd2de")
grafico1 <- tabla_actividad %>% ggplot(mapping = aes(x=Edad, y=porcentaje, fill=Sexo)) +
geom_chicklet(position = position_dodge(width = 0.75), width=0.7, show.legend = F) +
scale_fill_manual(values=colores) + scale_y_continuous(labels = percent, limits = c(0,1)) +
labs(y = "Tasa de participación laboral", title ="Participación laboral por edad para <span style = 'color: #29aee4;'>**hombres**</span> y <span style='color: #0c8136;'>**mujeres**</span> ", subtitle ="Primer trimestre 2021", x = "") +
theme(text = element_text(family = "Open Sans"), plot.title = element_markdown(size = 14), plot.title.position = "plot", plot.subtitle = element_text(size = 8), axis.title = element_text(size=8), legend.position = "bottom", legend.text = element_text(size = 8), legend.title = element_blank(), axis.text = element_text(colour = "BLACK", family="Open Sans", size = 7), panel.background = element_blank(), panel.grid.major = element_blank())
grafico1
ggsave("grafico1.svg")
#Filtros
primariacompleta <- eph1t %>%  filter(AGLOMERADO==12 & ESTADO!=0 & NIVEL_ED %in% c(2,3))
secundariacompleta <- eph1t %>%  filter(AGLOMERADO==12 & ESTADO!=0 & NIVEL_ED %in% c(4,5))
superiorcompleto <- eph1t %>%  filter(AGLOMERADO==12 & ESTADO!=0 & NIVEL_ED==6)
#Hombres:
hombresprim <- primariacompleta %>%  filter(CH04==1)
hombresprim <- hombresprim %>% group_by(PEA) %>% summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresprim$PONDERA)),2), Sexo="Hombres", Nivel="Primaria Completa") %>% filter(PEA==1) %>% select(-PEA)
hombresprim
#Mujeres:
mujeresprim <- primariacompleta %>%  filter(CH04==2)
mujeresprim <- mujeresprim %>% group_by(PEA) %>% summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeresprim$PONDERA)),2), Sexo="Mujeres", Nivel="Primaria Completa") %>% filter(PEA==1) %>% select(-PEA)
mujeresprim
primariacomp <- bind_rows(hombresprim, mujeresprim) %>% mutate("Brecha"=formattable::percent((0.4848-0.2125)))
primariacomp
knitr::opts_chunk$set(echo = TRUE)
#Librerías
library(ggtext)
library(eph)
library(tidyverse)
library(formattable)
library(Hmisc)
library(readxl)
library(foreign)
library(glue)
library(extrafont)
library(ggalt)
library(waffle)
library(ggimage)
library(spatstat)
library(splitstackshape)
library(purrr)
library(treemapify)
library(scales)
library(forcats)
library(svglite)
library(ggchicklet)
library(ggpubr)
#Fuente
font_import(paths = "./Open_Sans", prompt = F)
loadfonts(device = "win", quiet=T)
#Colores
colores<- c("#e22172","#0c8136","#e22172","#f4a018","#428cb4","#c85687","#dbac2f","#5da14a","#ff9a00")
gradiente<- c("#ed3068","#ef4275","#f3789d","#f69cb7","#fbd2de")
#Primer trimestre 2021
eph1ti<- get_microdata(year=2021, trimester=1, type="individual")
eph1tih <- get_microdata(year=2021, trimester=1, type="hogar")
eph1t <- left_join(eph1ti, eph1tih)
#Para mas adelante se necesitarán los datos del trimestre anterior, por lo que se procede a cargar la correspondiente base
#Cuartro trimestre 2020
ephi<- get_microdata(year=2020, trimester=4, type="individual")
ephh <- get_microdata(year=2020, trimester=4, type="hogar")
eph4t <- left_join(ephi, ephh)
#Se realiza un merge de ambas bases
ephtotal <- bind_rows(eph1t, eph4t)
ephtotalsd <- ephtotal %>% distinct(., CODUSU, NRO_HOGAR, COMPONENTE, .keep_all = T)
#Primer trimestre 2021
eph1t <- eph1t %>%  mutate(PEA= case_when(ESTADO==3 ~ 0,
ESTADO==4 ~ 0,
ESTADO==1 ~ 1,
ESTADO==2 ~ 1),
OCUPADOS= case_when(ESTADO==1 ~ 1,
ESTADO==2 ~ 0,
ESTADO==3 ~ 0,
ESTADO==4 ~ 0),
DESOCUPADOS= case_when(ESTADO==1 ~ 0,
ESTADO==2 ~ 1),
EMPLEADOS= case_when(PP04A==1 ~ "Empleados Publicos",
PP04A==2 ~ "Empleados privados",
PP04A==3 ~ "Otros",
TRUE ~ NA_character_),
PP04B_COD=as.character(PP04B_COD),
PP04B_COD=case_when(nchar(PP04B_COD)==4~PP04B_COD,
nchar(PP04B_COD)==1~ paste0("0",PP04B_COD,"00"),
nchar(PP04B_COD)==2~ paste0(PP04B_COD,"00"),
nchar(PP04B_COD)==3~ paste0("0",PP04B_COD)),
SECTOR= substr(PP04B_COD,1,2),
INFORMALES=case_when( CAT_OCUP==3 & PP07H==2 ~ 1,
CAT_OCUP==3 & PP07H==1 ~ 0),
PP04D_COD = as.character(PP04D_COD),
PP04D_COD = case_when(nchar(PP04D_COD) == 5 ~ PP04D_COD,
nchar(PP04D_COD) == 4 ~ paste0("0", PP04D_COD),
nchar(PP04D_COD) == 3 ~ paste0("00", PP04D_COD),
nchar(PP04D_COD) == 2 ~ paste0("000", PP04D_COD),
nchar(PP04D_COD) == 1 ~ paste0("0000", PP04D_COD)),
CALIFICACION = substr(PP04D_COD, 5, 5),
CALIFICACION = case_when(CALIFICACION=="1" ~ "Profesionales",
CALIFICACION=="2" ~ "Técnicos",
CALIFICACION=="3" ~ "Operativos",
CALIFICACION=="4" ~ "No Calificados"),
CALIFICACION = factor(CALIFICACION, c("No Calificados", "Operativos", "Técnicos", "Profesionales")),
TIPOCALIFICACION= case_when(CALIFICACION=="Profesionales" | CALIFICACION== "Técnicos" ~ "Calificado",
CALIFICACION=="No Calificados" | CALIFICACION=="Operativos" ~ "No calificado"),
SEXO= case_when(CH04==1 ~ "Hombres",
CH04==2 ~ "Mujeres"))
#EPH fusionada
ephtotalsd <- ephtotalsd %>%  mutate(PEA= case_when(ESTADO==3 ~ 0,
ESTADO==4 ~ 0,
ESTADO==1 ~ 1,
ESTADO==2 ~ 1),
OCUPADOS= case_when(ESTADO==1 ~ 1,
ESTADO==2 ~ 0,
ESTADO==3 ~ 0,
ESTADO==4 ~ 0),
DESOCUPADOS= case_when(ESTADO==1 ~ 0,
ESTADO==2 ~ 1),
EMPLEADOS= case_when(PP04A==1 ~ "Empleados Publicos",
PP04A==2 ~ "Empleados privados",
PP04A==3 ~ "Otros",
TRUE ~ NA_character_),
PP04B_COD=as.character(PP04B_COD),
PP04B_COD=case_when(nchar(PP04B_COD)==4~PP04B_COD,
nchar(PP04B_COD)==1~ paste0("0",PP04B_COD,"00"),
nchar(PP04B_COD)==2~ paste0(PP04B_COD,"00"),
nchar(PP04B_COD)==3~ paste0("0",PP04B_COD)),
SECTOR= substr(PP04B_COD,1,2),
INFORMALES=case_when( CAT_OCUP==3 & PP07H==2 ~ 1,
CAT_OCUP==3 & PP07H==1 ~ 0),
PP04D_COD = as.character(PP04D_COD),
PP04D_COD = case_when(nchar(PP04D_COD) == 5 ~ PP04D_COD,
nchar(PP04D_COD) == 4 ~ paste0("0", PP04D_COD),
nchar(PP04D_COD) == 3 ~ paste0("00", PP04D_COD),
nchar(PP04D_COD) == 2 ~ paste0("000", PP04D_COD),
nchar(PP04D_COD) == 1 ~ paste0("0000", PP04D_COD)),
CALIFICACION = substr(PP04D_COD, 5, 5),
CALIFICACION = case_when(CALIFICACION=="1" ~ "Profesionales",
CALIFICACION=="2" ~ "Técnicos",
CALIFICACION=="3" ~ "Operativos",
CALIFICACION=="4" ~ "No Calificados"),
CALIFICACION = factor(CALIFICACION, c("No Calificados", "Operativos", "Técnicos", "Profesionales")),
TIPOCALIFICACION= case_when(CALIFICACION=="Profesionales" | CALIFICACION== "Técnicos" ~ "Calificado",
CALIFICACION=="No Calificados" | CALIFICACION=="Operativos" ~ "No calificado"))
#Filtros
primariacompleta <- eph1t %>%  filter(AGLOMERADO==12 & ESTADO!=0 & NIVEL_ED %in% c(2,3))
secundariacompleta <- eph1t %>%  filter(AGLOMERADO==12 & ESTADO!=0 & NIVEL_ED %in% c(4,5))
superiorcompleto <- eph1t %>%  filter(AGLOMERADO==12 & ESTADO!=0 & NIVEL_ED==6)
#Primaria completa
#Hombres:
hombresprim <- primariacompleta %>%  filter(CH04==1)
hombresprim <- hombresprim %>% group_by(PEA) %>% summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresprim$PONDERA)),2), Sexo="Hombres", Nivel="Primaria Completa") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres:
mujeresprim <- primariacompleta %>%  filter(CH04==2)
mujeresprim <- mujeresprim %>% group_by(PEA) %>% summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeresprim$PONDERA)),2), Sexo="Mujeres", Nivel="Primaria Completa") %>% filter(PEA==1) %>% select(-PEA)
primariacomp <- bind_rows(hombresprim, mujeresprim) %>% mutate("Brecha"=formattable::percent((0.4848-0.2125)))
#Secundaria completa
#Hombres:
hombressec <- secundariacompleta %>%  filter(CH04==1)
hombressec <- hombressec %>% group_by(PEA) %>% summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombressec$PONDERA)),2), Sexo="Hombres", Nivel="Secundaria Completa") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres:
mujeressec <- secundariacompleta %>%  filter(CH04==2)
mujeressec <- mujeressec %>% group_by(PEA) %>% summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeressec$PONDERA)),2), Sexo="Mujeres", Nivel="Secundaria Completa") %>% filter(PEA==1) %>% select(-PEA)
secundariacomp <- bind_rows(hombressec, mujeressec) %>% mutate("Brecha"=formattable::percent((0.6582-0.5618)))
#Superior completo
#Hombres:
hombressup <- superiorcompleto %>%  filter(CH04==1)
hombressup <- hombressup %>% group_by(PEA) %>% summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombressup$PONDERA)),2), Sexo="Hombres", Nivel="Superior Completo") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres:
mujeressup <- superiorcompleto %>%  filter(CH04==2)
mujeressup <- mujeressup %>% group_by(PEA) %>% summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeressup$PONDERA)),2), Sexo="Mujeres", Nivel="Superior Completo") %>% filter(PEA==1) %>% select(-PEA)
superiorcomp <- bind_rows(hombressup, mujeressup) %>% mutate("Brecha"=formattable::percent((0.8388-0.7390)))
nivelalcanzado <- bind_rows(primariacomp, secundariacomp, superiorcomp)
nivelalcanzado
horastrabtotales <- eph1t %>% mutate(horastrabtotales= PP3E_TOT + PP3F_TOT)
hombresact15 <- eph1t %>%  filter(CH04==1 & AGLOMERADO==12 & ESTADO!=0 & CH06<=24 & CH06>=15)
hombresact15 <- hombresact15 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact15$PONDERA)),2), Sexo="Hombres", Edad="15-24 años") %>% filter(PEA==1) %>% select(-PEA)
hombresact15
hombresact15 <- eph1t %>%  filter(CH04==1 & AGLOMERADO==12 & ESTADO!=0 & CH06<=24 & CH06>=15)
hombresact15 <- hombresact15 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact15$PONDERA)),2), Sexo="Hombres", Edad="15-24 años") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres
mujeresact15 <- eph1t %>%  filter(CH04==2 & AGLOMERADO==12 & ESTADO!=0 & CH06<=24 & CH06>=15)
mujeresact15 <- mujeresact15 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeresact15$PONDERA)),2), Sexo="Mujeres", Edad="15-24 años") %>% filter(PEA==1) %>% select(-PEA)
act15a24 <- bind_rows(hombresact15, mujeresact15)
act15a24
#25 a 34 años
#Hombres
hombresact25 <- edad25a34 %>%  filter(CH04==1 & )
#25 a 34 años
#Hombres
hombresact25 <- eph1t %>%  filter(CH04==1 & AGLOMERADO==12 & ESTADO!=0 & CH06<=34 & CH06>=25)
hombresact25 <- hombresact25 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact25$PONDERA)),2), Sexo="Hombres", Edad="25-34 años") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres
mujeresact25 <- eph1t %>%  filter(CH04==2 & AGLOMERADO==12 & ESTADO!=0 & CH06<=34 & CH06>=25)
mujeresact25 <- mujeresact25 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeresact25$PONDERA)),2), Sexo="Mujeres", Edad="25-34 años") %>% filter(PEA==1) %>% select(-PEA)
act25a34 <- bind_rows(hombresact25, mujeresact25)
act25a34
#35 a 44 años
#Hombres
hombresact35 <- eph1t %>%  filter(CH04==1 & AGLOMERADO==12 & ESTADO!=0 & CH06<=44 & CH06>=35)
hombresact35 <- hombresact35 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact35$PONDERA)),2), Sexo="Hombres", Edad="35-44 años") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres
mujeresact35 <- eph1t %>%  filter(CH04==2 & AGLOMERADO==12 & ESTADO!=0 & CH06<=44 & CH06>=35)
mujeresact35 <- mujeresact35 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeresact35$PONDERA)),2), Sexo="Mujeres", Edad="35-44 años") %>% filter(PEA==1) %>% select(-PEA)
act35a44 <- bind_rows(hombresact35, mujeresact35)
act35a44
#Hombres
hombresact45 <- eph1t %>%  filter(CH04==1 & AGLOMERADO==12 & ESTADO!=0 & CH06<=59 & CH06>=45)
hombresact45 <- hombresact45 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact45$PONDERA)),2), Sexo="Hombres", Edad="45-59 años") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres
mujeresact45 <- eph1t %>%  filter(CH04==2 & AGLOMERADO==12 & ESTADO!=0 & CH06<=59 & CH06>=45)
mujeresact45 <- mujeresact45 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeresact45$PONDERA)),2), Sexo="Mujeres", Edad="45-59 años") %>% filter(PEA==1) %>% select(-PEA)
act45a59 <- bind_rows(hombresact45, mujeresact45)
act45a59
#+60
#Hombres
hombresact60 <- eph1t %>%  filter(CH04==1 & AGLOMERADO==12 & ESTADO!=0 & CH06>=60)
hombresact60 <- hombresact60 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact60$PONDERA)),2), Sexo="Hombres", Edad="Igual o mayor a 60 años") %>% filter(PEA==1) %>% select(-PEA)
#Mujeres
mujeresact60 <- eph1t %>%  filter(CH04==2 & AGLOMERADO==12 & ESTADO!=0 & CH06>=60)
mujeresact60 <- mujeresact60 %>%
group_by(PEA) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(mujeresact60$PONDERA)),2), Sexo="Mujeres", Edad="Igual o mayor a 60 años") %>% filter(PEA==1) %>% select(-PEA)
act60 <- bind_rows(hombresact60, mujeresact60)
act60
hombresprim <- eph1t %>%  filter(CH04==1 & AGLOMERADO==12 & ESTADO!=0 & NIVEL_ED %in% c(2,3))
hombresprim <- hombresprim %>% group_by(PEA) %>% summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresprim$PONDERA)),2), Sexo="Hombres", Nivel="Primaria Completa") %>% filter(PEA==1) %>% select(-PEA)
hombresprim
eph1t <- eph1t %>%  mutate(PEA= case_when(ESTADO==3 ~ 0,
ESTADO==4 ~ 0,
ESTADO==1 ~ 1,
ESTADO==2 ~ 1),
OCUPADOS= case_when(ESTADO==1 ~ 1,
ESTADO==2 ~ 0,
ESTADO==3 ~ 0,
ESTADO==4 ~ 0),
DESOCUPADOS= case_when(ESTADO==1 ~ 0,
ESTADO==2 ~ 1),
EMPLEADOS= case_when(PP04A==1 ~ "Empleados Publicos",
PP04A==2 ~ "Empleados privados",
PP04A==3 ~ "Otros",
TRUE ~ NA_character_),
PP04B_COD=as.character(PP04B_COD),
PP04B_COD=case_when(nchar(PP04B_COD)==4~PP04B_COD,
nchar(PP04B_COD)==1~ paste0("0",PP04B_COD,"00"),
nchar(PP04B_COD)==2~ paste0(PP04B_COD,"00"),
nchar(PP04B_COD)==3~ paste0("0",PP04B_COD)),
SECTOR= substr(PP04B_COD,1,2),
INFORMALES=case_when( CAT_OCUP==3 & PP07H==2 ~ 1,
CAT_OCUP==3 & PP07H==1 ~ 0),
PP04D_COD = as.character(PP04D_COD),
PP04D_COD = case_when(nchar(PP04D_COD) == 5 ~ PP04D_COD,
nchar(PP04D_COD) == 4 ~ paste0("0", PP04D_COD),
nchar(PP04D_COD) == 3 ~ paste0("00", PP04D_COD),
nchar(PP04D_COD) == 2 ~ paste0("000", PP04D_COD),
nchar(PP04D_COD) == 1 ~ paste0("0000", PP04D_COD)),
CALIFICACION = substr(PP04D_COD, 5, 5),
CALIFICACION = case_when(CALIFICACION=="1" ~ "Profesionales",
CALIFICACION=="2" ~ "Técnicos",
CALIFICACION=="3" ~ "Operativos",
CALIFICACION=="4" ~ "No Calificados"),
CALIFICACION = factor(CALIFICACION, c("No Calificados", "Operativos", "Técnicos", "Profesionales")),
TIPOCALIFICACION= case_when(CALIFICACION=="Profesionales" | CALIFICACION== "Técnicos" ~ "Calificado",
CALIFICACION=="No Calificados" | CALIFICACION=="Operativos" ~ "No calificado"),
SEXO= case_when(CH04==1 ~ "Hombres",
CH04==2 ~ "Mujeres"),
horastrabtotales= PP3E_TOT + PP3F_TOT)
#15-24 años
horastrab15 <- horastrabtotales %>% filter (AGLOMERADO==12 & ESTADO!=0 & CH06<=24 & CH06>=15 & !is.na(horastrabtotales))
horastrab15 <- horastrab15 %>%  group_by(SEXO) %>% summarise(horas=horastrabtotales%*%PONDERA/sum(PONDERA), Edad= "15-24 años")
horastrab15 <- horastrab15 %>% arrange(horas) %>% mutate(Brecha=horas- lag(horas, default = first(horas)))
brecha15= round(as.numeric(horastrab15[2, "Brecha"]),2)
horastrab15 <- horastrab15 %>% mutate(Brecha= brecha15)
horastrab15
horastrab25 <- horastrabtotales %>% filter (AGLOMERADO==12 & ESTADO!=0 & CH06<=34 & CH06>=25 & !is.na(horastrabtotales))
horastrab25 <- horastrab25 %>%  group_by(SEXO) %>% summarise(horas=horastrabtotales%*%PONDERA/sum(PONDERA), Edad="25-34 años")
horastrab25 <- horastrab25 %>% arrange(horas) %>% mutate(Brecha=horas- lag(horas, default = first(horas)))
brecha25= round(as.numeric(horastrab25[2, "Brecha"]),2)
horastrab25 <- horastrab25 %>% mutate(Brecha= brecha25)
horastrab25
#35 a 44
horastrab35 <- horastrabtotales %>% filter (AGLOMERADO==12 & ESTADO!=0 & CH06<=44 & CH06>=35 & !is.na(horastrabtotales))
horastrab35 <- horastrab35 %>%  group_by(SEXO) %>% summarise(horas=horastrabtotales%*%PONDERA/sum(PONDERA), Edad="35-44 años")
horastrab35 <- horastrab35 %>% arrange(horas) %>% mutate(Brecha=horas- lag(horas, default = first(horas)))
brecha35= round(as.numeric(horastrab35[2, "Brecha"]),2)
horastrab35 <- horastrab35 %>% mutate(Brecha= brecha35)
horastrab35
#45 a 59
horastrab45 <- horastrabtotales %>% filter (AGLOMERADO==12 & ESTADO!=0 & CH06<=59 & CH06>=45 & !is.na(horastrabtotales))
horastrab45 <- horastrab45 %>%  group_by(SEXO) %>% summarise(horas=horastrabtotales%*%PONDERA/sum(PONDERA), Edad="45-59 años")
horastrab45 <- horastrab45 %>% arrange(horas) %>% mutate(Brecha=horas- lag(horas, default = first(horas)))
brecha45= round(as.numeric(horastrab45[2, "Brecha"]),2)
horastrab45 <- horastrab45 %>% mutate(Brecha= brecha45)
horastrab45
#mayores de 60
horastrab60 <- horastrabtotales %>% filter (AGLOMERADO==12 & ESTADO!=0 & CH06>=60 & !is.na(horastrabtotales))
horastrab60 <- horastrab60 %>%  group_by(SEXO) %>% summarise(horas=horastrabtotales%*%PONDERA/sum(PONDERA), Edad="Igual o mayor a 60 años")
horastrab60 <- horastrab60 %>% arrange(horas) %>% mutate(Brecha=horas- lag(horas, default = first(horas)))
brecha60= round(as.numeric(horastrab60[2, "Brecha"]),2)
horastrab60 <- horastrab60 %>% mutate(Brecha= brecha60)
horastrab60
horastrabajadas <- bind_rows(horastrab15, horastrab25, horastrab35, horastrab45, horastrab60)
horastrab15 <- horastrabtotales %>% filter (AGLOMERADO==12 & ESTADO!=0 & CH06<=24 & CH06>=15 & !is.na(horastrabtotales))
horastrab15 <- horastrab15 %>%  group_by(SEXO) %>% summarise(horas=horastrabtotales%*%PONDERA/sum(PONDERA), Edad= "15-24 años")
horastrab15 <- horastrab15 %>% arrange(horas) %>% mutate(Brecha=horas- lag(horas, default = first(horas)))
brecha15= round(as.numeric(horastrab15[2, "Brecha"]),2)
horastrab15 <- horastrab15 %>% mutate(Brecha= brecha15)
horastrab15
horastrab15 <- horastrabtotales %>% filter (AGLOMERADO==12 & ESTADO!=0 & CH06<=24 & CH06>=15 & !is.na(horastrabtotales))
horastrab15 <- horastrab15 %>%  group_by(SEXO) %>% summarise(horas=horastrabtotales%*%PONDERA/sum(PONDERA), Edad= "15-24 años") %>%
arrange(horas) %>%
mutate(Brecha=horas- lag(horas, default = first(horas)))
brecha15= round(as.numeric(horastrab15[2, "Brecha"]),2)
horastrab15 <- horastrab15 %>% mutate(Brecha= brecha15)
horastrab15
horastrab15 <- eph1t %>%
filter (AGLOMERADO==12 & ESTADO!=0 & CH06<=24 & CH06>=15 & !is.na(horastrabtotales))
horastrab15 <- horastrab15 %>%  group_by(SEXO) %>% summarise(horas=horastrabtotales%*%PONDERA/sum(PONDERA), Edad= "15-24 años") %>%
arrange(horas) %>%
mutate(Brecha=horas- lag(horas, default = first(horas)))
brecha15= round(as.numeric(horastrab15[2, "Brecha"]),2)
horastrab15 <- horastrab15 %>% mutate(Brecha= brecha15)
horastrab15
horastrab25 <- eph1t %>% filter (AGLOMERADO==12 & ESTADO!=0 & CH06<=34 & CH06>=25 & !is.na(horastrabtotales))
horastrab25 <- horastrab25 %>%  group_by(SEXO) %>% summarise(horas=horastrabtotales%*%PONDERA/sum(PONDERA), Edad="25-34 años") %>%
arrange(horas) %>%
mutate(Brecha=horas- lag(horas, default = first(horas)), round(as.numeric(horastrab25[2, "Brecha"]),2))
horastrab25 <- eph1t %>% filter (AGLOMERADO==12 & ESTADO!=0 & CH06<=34 & CH06>=25 & !is.na(horastrabtotales))
horastrab25 <- horastrab25 %>%  group_by(SEXO) %>% summarise(horas=horastrabtotales%*%PONDERA/sum(PONDERA), Edad="25-34 años") %>%
arrange(horas) %>%
mutate(Brecha=horas- lag(horas, default = first(horas))) %>%  mutate(Brecha= round(as.numeric(horastrab25[2, "Brecha"]),2))
horastrab25 <- eph1t %>% filter (AGLOMERADO==12 & ESTADO!=0 & CH06<=34 & CH06>=25 & !is.na(horastrabtotales))
horastrab25 <- horastrab25 %>%  group_by(SEXO) %>% summarise(horas=horastrabtotales%*%PONDERA/sum(PONDERA), Edad="25-34 años") %>%
arrange(horas) %>%
mutate(Brecha=horas- lag(horas, default = first(horas)))
horastrab25 <- eph1t %>% filter (AGLOMERADO==12 & ESTADO!=0 & CH06<=34 & CH06>=25 & !is.na(horastrabtotales))
horastrab25 <- horastrab25 %>%  group_by(SEXO) %>% summarise(horas=horastrabtotales%*%PONDERA/sum(PONDERA), Edad="25-34 años") %>%
arrange(horas) %>%
mutate(Brecha=horas- lag(horas, default = first(horas)))
brecha25= round(as.numeric(horastrab25[2, "Brecha"]),2)
horastrab25 <- horastrab25 %>% mutate(Brecha= brecha25)
horastrab25
hombresact15 <- eph1t %>%  filter(CH04==1 & AGLOMERADO==12 & ESTADO!=0 & CH06<=24 & CH06>=15 & PEA==1)
hombresact15 <- hombresact15 %>%
group_by(SEXO) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact15$PONDERA)),2), SEXO, Edad="15-24 años")
hombresact15
hombresact15 <- eph1t %>%  filter(CH04==1 & AGLOMERADO==12 & ESTADO!=0 & CH06<=24 & CH06>=15 & PEA==1)
hombresact15 <- hombresact15 %>%
group_by(SEXO) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact15$PONDERA)),2), Edad="15-24 años")
hombresact15
hombresact15 <- eph1t %>%  filter(AGLOMERADO==12 & ESTADO!=0 & CH06<=24 & CH06>=15 & PEA==1)
hombresact15 <- hombresact15 %>%
group_by(SEXO) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact15$PONDERA)),2), Edad="15-24 años")
hombresact15
hombresact15 <- eph1t %>%  filter(AGLOMERADO==12 & ESTADO!=0 & CH06<=24 & CH06>=15 & PEA==1)
hombresact15 <- hombresact15 %>%
group_by(PEA, SEXO) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact15$PONDERA)),2), Edad="15-24 años")
hombresact15
hombresact15 <- eph1t %>%  filter(AGLOMERADO==12 & ESTADO!=0 & CH06<=24 & CH06>=15)
hombresact15 <- hombresact15 %>%
group_by(PEA, SEXO) %>%
summarise(porcentaje=formattable::percent((sum(PONDERA)/sum(hombresact15$PONDERA)),2), Edad="15-24 años")
hombresact15
horastrabajadasgr <- horastrabajadas %>% mutate(horas=round(horas))
horastrabajadasgr <- horastrabajadasgr %>% pivot_wider(names_from = SEXO, values_from = horas)
grafico3<- horastrabajadasgr %>% ggplot() + geom_dumbbell(aes(y=Edad, x=Mujeres, xend=Hombres),
size=1.2, color="#b2b2b2", size_x=3, size_xend = 3, colour_x =colores[2], colour_xend =colores[1])  + geom_text(aes(x=Mujeres, y=Edad, label=Mujeres),
color="BLACK", size=2.75, vjust=2.5, family="Open Sans") + geom_text(aes(x=Hombres, y=Edad, label=Hombres),
color="BLACK", size=2.75, vjust=2.5, family="Open Sans") + labs(fill="", title = "Carga laboral semanal por edad de <span style='color: #29aee4;'>**Hombres**</span> y <span style='color: #0c8136;'>**Mujeres**</span>", subtitle = "Primer trimestre 2021", caption = "", x="Horas trabajadas")+ ylab("")  + theme(axis.title = element_text(), aspect.ratio=0.5, axis.text = element_text(color = "BLACK"), legend.position = "right", title = element_text(), panel.grid.major = element_blank(), legend.text = element_text(), panel.background = element_blank())  + scale_fill_manual(values = colores, aesthetics = "color")  + labs(color="") + theme(legend.key = element_blank(), panel.grid.major.y =  element_line(colour = "BLACK", linetype = "dotted"), axis.text.y = element_text(hjust = 0), plot.title.position = "plot", plot.title = element_markdown(), text = element_text(family = "Open Sans" ))
grafico3
empleo <- eph1t %>% filter(AGLOMERADO==12 & !is.na(OCUPADOS))
empleo <- empleo %>%  group_by(OCUPADOS) %>%  summarise(formattable::percent(sum(PONDERA)/sum(empleo$PONDERA)))
empleo
empleo <- eph1t %>% filter(AGLOMERADO==12 & !is.na(OCUPADOS))%>%
group_by(OCUPADOS) %>%
summarise(formattable::percent(sum(PONDERA)/sum(empleo$PONDERA)))
empleo
empleo <- eph1t %>% filter(AGLOMERADO==12 & !is.na(OCUPADOS))
empleo <- empleo %>%  group_by(OCUPADOS) %>%  summarise(formattable::percent(sum(PONDERA)/sum(empleo$PONDERA)))
empleo
empleados <- eph1t %>% filter(AGLOMERADO==12 & !is.na(EMPLEADOS) & OCUPADOS==1)
table(empleados$EMPLEADOS)
empleados <- empleados %>%  group_by(EMPLEADOS) %>%  summarise(sum(PONDERA))
empleados
empleados <- empleados %>% filter(EMPLEADOS!="Otros") %>% mutate(porcentaje=(`sum(PONDERA)`/sum(empleados$`sum(PONDERA)`))) %>% select(EMPLEADOS, porcentaje) %>% mutate(numeros=round(porcentaje*100,0))
empleados
empleados <- eph1t %>% filter(AGLOMERADO==12 & !is.na(EMPLEADOS) & OCUPADOS==1 & EMPLEADOS!="Otros")
empleados <- empleados %>%  group_by(EMPLEADOS) %>%  summarise(sum(PONDERA))
empleados <- empleados %>% filter() %>% mutate(porcentaje=(`sum(PONDERA)`/sum(empleados$`sum(PONDERA)`))) %>% select(EMPLEADOS, porcentaje) %>% mutate(numeros=round(porcentaje*100,0))
empleados
empleados <- eph1t %>% filter(AGLOMERADO==12 & !is.na(EMPLEADOS) & OCUPADOS==1 & EMPLEADOS!="Otros")
empleados <- empleados %>%  group_by(EMPLEADOS) %>%  summarise(sum(PONDERA))
empleados <- empleados %>% mutate(porcentaje=(sum(PONDERA)/sum(empleados$sum(PONDERA)))) %>% select(EMPLEADOS, porcentaje) %>% mutate(numeros=round(porcentaje*100,0))
empleados <- eph1t %>% filter(AGLOMERADO==12 & !is.na(EMPLEADOS) & OCUPADOS==1 & EMPLEADOS!="Otros")
empleados <- empleados %>%  group_by(EMPLEADOS) %>%  summarise(sum(PONDERA))
empleados <- empleados %>% mutate(porcentaje=(`sum(PONDERA)`/sum(empleados$`sum(PONDERA)`))) %>% select(EMPLEADOS, porcentaje) %>% mutate(numeros=round(porcentaje*100,0))
empleados
empleadosacum <- cumsum(empleados$porcentaje)
empleadosacummin <- formattable::percent(c(0, head(empleadosacum, n=-1)))
empleadosacummin
```{r}
empleados <- eph1t %>% filter(AGLOMERADO==12 & !is.na(EMPLEADOS) & OCUPADOS==1)
table(empleados$EMPLEADOS) #Se filtra al tipo "otros"
empleados <- empleados %>% filter(EMPLEADOS!="Otros") %>%
group_by(EMPLEADOS) %>%
summarise(sum(PONDERA))
empleados <- empleados  %>% mutate(porcentaje=(`sum(PONDERA)`/sum(empleados$`sum(PONDERA)`))) %>%
select(EMPLEADOS, porcentaje) %>%
mutate(numeros=round(porcentaje*100,0))
empleados
pobcalificada<- eph1t %>% filter(AGLOMERADO==12 & !is.na(CALIFICACION))
pobcalificada<- pobcalificada %>% group_by(TIPOCALIFICACION) %>% summarise(porcentaje=formattable::percent(sum(PONDERA)/sum(pobcalificada$PONDERA)),  sum(PONDERA), sum(pobcalificada$PONDERA))
pobcalificada
promedioedad<- eph1t %>% filter(AGLOMERADO==12 &  OCUPADOS==1)
promedioedad<- promedioedad %>% group_by(EMPLEADOS) %>% summarise((CH06%*%PONDERA)/sum(PONDERA))
promedioedad
#Sector público
cargalaboralpub <- horastrabtotales %>% filter (AGLOMERADO==12 & ESTADO!=0 & !is.na(horastrabtotales) & PP04A==1)
cargalaboralpub <- cargalaboralpub %>% summarise(horastrabtotales%*%PONDERA/sum(PONDERA))
cargalaboralpub
#Sector privado
cargalaboralpriv <- horastrabtotales %>% filter (AGLOMERADO==12 & ESTADO!=0 & !is.na(horastrabtotales) & PP04A==2)
cargalaboralpriv <- cargalaboralpriv %>% summarise(horastrabtotales%*%PONDERA/sum(PONDERA))
cargalaboralpriv
