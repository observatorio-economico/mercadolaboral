padron2<- padron %>% rename(CUIT=ï..CUIT)
##############################################################################
dniyedades<- read.csv("dniyedades.csv", header=T, sep = ";")
dniencuesta<- read_csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQSkq043ZSTeA5d3Q_E8D-CS-uyzzabQlGTK_Zhq_UENOwCIiDeDn09yYhBsdby4Vvx-xIARnhzXd3q/pub?gid=1734940971&single=true&output=csv")
dniencuesta<- dniencuesta %>% select(-`Marca temporal`)
#########################################################
basejm<- read_excel("basednijm.xlsx")
basejm<- basejm %>% mutate(ldni=log(Docum))
##AcÃ¡ vemos la distribuciÃ³n de los documentos para deterctar los outliers
hist(basejm$Docum)
##filtramos los otuliers
basejm<- basejm %>% filter(!Docum>=6e+07)
##modelo log
modeloEdadDNIljm<- lm(basejm$Edad2~basejm$ldni)
#Guardamos los fit del log para comparar
basejm<- basejm %>% mutate(fitlog=modeloEdadDNIljm$fitted.values)
##Hacemos un summary para sacar el r2
summary(modeloEdadDNIljm)$r.squared
#Vemos la distribuiciÃ³n de los residuales
hist(modeloEdadDNIljm$residuals)
##Ahora vemos que tal ajusta el modelo lineal
modeloEdadDNIjm<- lm(basejm$Edad2~basejm$Docum)
#Graficamos para ver la distribuciÃ³n de residuales
lineal<- ggplot(mapping=aes(modeloEdadDNIjm$residuals)) + geom_histogram() + xlab("modelo lineal")
log<- ggplot(mapping=aes(modeloEdadDNIljm$residuals))+ geom_histogram() + xlab("modelo log")
lay <- rbind(c(1,1,NA,2,2),
c(1,1,NA,2,2),
c(1,1,NA,2,2),
c(1,1,NA,2,2))
d<-grid.arrange(lineal, log, layout_matrix=lay)
#Claramente la distribuciÃ³n de residuales del modelo lineal estÃ¡ mas centrada en cero, podemos decir que a fines predictivos tiene un
#menor residuo en  promedio.
#Guardamos los fit en la base del modelo lineal
basejm<- basejm %>% mutate(fitlin=modeloEdadDNIjm$fitted.values)
##Graficamos ambos modelos
ggplot(mapping=aes(x=basejm$Edad2, y=basejm$Docum)) + geom_point() + geom_line(aes(x=basejm$fitlog, y=basejm$Docum, colour="LOG")) +
geom_line(aes(x=basejm$fitlin, y=basejm$Docum, colour="Lineal")) + labs(colour="Tipo de modelo") + xlab("Edad") + ylab("Documento")
## ajusta mejor el modelo lineal que el logaritmico
#Calculadora de edad con dni de los distintos modelos para probar
jmlogcal<- function(i) {
y<-summary(modeloEdadDNIljm)$coefficients[1,1]+summary(modeloEdadDNIljm)$coefficients[2,1]*log(i)
return(y)
}
jmlogcal(39862931)
jmlincal<- function(i) {
y<-summary(modeloEdadDNIjm)$coefficients[1,1]+summary(modeloEdadDNIjm)$coefficients[2,1]*(i)
return(y)
}
jmlincal(39862931)
########################################################
dnien<- dniencuesta %>% filter(dniencuesta$Edad<=70)
dnien$DNI<- as.numeric(dnien$DNI)
dnien<- dnien %>% filter(!is.na(DNI))
modeloEdadDNI<-  lm(dnien$Edad ~ dnien$DNI)
summary(modeloEdadDNI)
modelofit<- as.data.frame(modeloEdadDNI$fitted.values)
base<- data.frame(dnien, modelofit)
base
# hacemos la calculadorta para el nuevo modelo estimado
calcupropia<- function(i) {
y<- summary(modeloEdadDNI)$coefficients[1,1]+summary(modeloEdadDNI)$coefficients[2,1]*i
return(y)
}
#Probamos las calculadoras
calcupropia(40508225)
jmlincal(40508225)
jmlogcal(40508225)
oo<- as.data.frame(modeloEdadDNI$coefficients)
oo[1,1]
padron<- padron %>% mutate(edadesti1=round(oo[1,1]+(oo[2,1]*padron$DNI))) %>%
mutate(edadesti2=round(summary(modeloEdadDNIjm)$coefficient[1,1]+summary(modeloEdadDNIjm)$coefficient[2,1]*padron$DNI)) %>%
mutate(edadesti3=round(summary(modeloEdadDNIljm)$coefficient[1,1]+summary(modeloEdadDNIljm)$coefficient[2,1]*log(padron$DNI)))
padron<- padron %>% filter(!DNI>=50000000)
padron<- padron %>% mutate(franja=case_when(EDAD<25~ "18 a 24",
EDAD>=25 & EDAD<35 ~ "25 a 35",
EDAD>=35 & EDAD<45 ~ "35 a 45",
EDAD>=45 & EDAD<55 ~ "45 a 55",
EDAD>=55 & EDAD<65 ~ "55 a 65",
EDAD>=65 ~ "65+"))
CUITXFRANJA<- padron %>% group_by(franja) %>%  summarise(percent(sum(ï..CUIT)/sum(padron$ï..CUIT)))
CUITXFRANJA
padron<- padron %>% mutate(primercu=substr(ï..CUIT,1,2))
padron <- padron %>% filter(GENERO!="indefinido") %>% rename(CUIT=ï..CUIT)
padrondef<- left_join(padron,autos1)
padrondef<- left_join(padrondef, motos)
padrondef<- left_join(padrondef, inmuebles)
padrondef[,11][is.na(padrondef[,11])]<-0
padrondef[,13][is.na(padrondef[,13])]<-0
padrondef[,15][is.na(padrondef[,15])]<-0
padrondef<- padrondef %>% mutate(zonadefinitiva=case_when(!is.na(zonaauto)~zonaauto,
is.na(zonaauto) & !is.na(zonamotos)~ zonamotos,
is.na(zonaauto) & is.na(zonamotos) & !is.na(zonainmuebles) ~ zonainmuebles))
resumen<- padrondef %>% group_by(franja) %>% summarise(percent(sum(cantidadauto)/sum(padrondef$cantidadauto)), percent(sum(cantidadmotos)/sum(padrondef$cantidadmotos)), percent(sum(cantidadinmuebles)/sum(padrondef$cantidadinmuebles)))
resumen
resumen2<- padrondef %>% filter(!is.na(zonaauto)) %>% group_by(franja, zonaauto) %>% summarise(sum(cantidadauto))
resumen2
jovenes<-padrondef %>% filter(franja=="18 a 24")
muchosautos<- jovenes[which.max(jovenes$cantidadauto),]
muchosinmuebles<- jovenes[which.max(jovenes$cantidadinmuebles),]
muchasmotos<- jovenes[which.max(jovenes$cantidadmotos),]
#Exportar
padronexpor<- padrondef %>% mutate(id=vctrs::vec_group_id(padrondef))
padronexpor<- padronexpor %>% mutate(edad=edadesti2)
padronexpor<- padronexpor %>% relocate(id, before=CUIT)
padronexpor<- padronexpor %>% select(-c("CUIT", "TRIBUTO.DOMIC.DIRECCIONCONTRIB", "edadesti1","edadesti2","edadesti3", "EDAD","DNI", "primercu"))
write.csv(padronexpor, "padronexportar.csv")
porgenero<- padrondef %>% mutate(persona=1)
porgenero<- porgenero %>% group_by(GENERO) %>% summarise(sum(persona), percent(sum(persona)/sum(porgenero$persona))) %>%
rename(Cantidad=`sum(persona)`, Porcentaje=`percent(sum(persona)/sum(porgenero$persona))`)
porgenero
kableExtra::kable(porgenero, format = "markdown")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(formattable)
library(rvest)
library(XML)
library(readxl)
library(openxlsx)
library(gridExtra)
## hola soy gabriel
#dniyedades$DNI<- as.numeric(dniyedades$DNI)
#dsd<- dniyedades %>% filter(DNI>20000000 & DNI<=22000000) %>% summarise(EDAD)
#dsd[which.max(dsd$EDAD),1]
#dsd[which.min(dsd$EDAD),1]
setwd("C:\\Users\\alech\\OneDrive\\Documentos\\GitHub\\padron-contribuyentes")
autos<- read.csv("padron_autos.csv", sep=";", header = T, encoding ="UTF-8")
##########################
autos1<- autos %>% group_by(CUIT, ZONA_TRIBUTARIA) %>% count()
autos1<- autos1 %>% pivot_wider(names_from = ZONA_TRIBUTARIA, values_from=n)
autos1[,2:9][is.na(autos1[,2:9])]<-0
autos1<- autos1 %>% mutate(cantidadauto=`1`+`2`+`3`+`4`+`5`+`6`+`7`)
autos1<- autos1 %>% mutate(zonaauto=case_when(`1`>0 ~ 1,
`1`==0 & `2`>0~2,
`2`==0 & `3`>0~3,
`3`==0 & `4`>0~4,
`4`==0 & `5`>0~5,
`5`==0 & `6`>0~6,
`6`==0 & `7`>0~7))
#############################DEFINITIVO
autos1<- autos1 %>% select(CUIT,cantidadauto,zonaauto)
###############
###################################################
motos<- read.csv("padron_motos.csv", sep=";", header = T)
motos<- motos %>% group_by(CUIT,ZONA_TRIBUTARIA) %>% count()
motos<- motos %>% pivot_wider(names_from =ZONA_TRIBUTARIA ,values_from= n)
motos[,2:8][is.na(motos[,2:8])] <- 0
motos<- motos %>% mutate(cantidadmotos=`1`+`2`+`3`+`4`+`5`+`6`+`7`)
motos<- motos %>% mutate(zonamotos=case_when(`1`>0~1,
`1`==0 & `2`>0~2,
`2`==0 & `3`>0~3,
`3`==0 & `4`>0~4,
`4`==0 & `5`>0~5,
`5`==0 & `6`>0~6,
`6`==0 & `7`>0~7))
####DEFINITIVO MOTOS
motos<- motos %>% select(CUIT,cantidadmotos,zonamotos)
###################INMUEBLES
inmuebles<- read.csv("padron_inmuebles.csv", sep=";", header = T)
inmuebles<- inmuebles %>% group_by(CUIT,ZONA_TRIBUTARIA) %>% count()
inmuebles<- inmuebles %>% pivot_wider(names_from =ZONA_TRIBUTARIA ,values_from= n)
inmuebles[,2:8][is.na(inmuebles[,2:8])] <- 0
inmuebles<- inmuebles %>% mutate(cantidadinmuebles=`1`+`2`+`3`+`4`+`5`+`6`+`7`)
inmuebles<- inmuebles %>% mutate(zonainmuebles=case_when(`1`>0~1,
`1`==0 & `2`>0~2,
`2`==0 & `3`>0~3,
`3`==0 & `4`>0~4,
`4`==0 & `5`>0~5,
`5`==0 & `6`>0~6,
`6`==0 & `7`>0~7))
#####Definitivo inmuebles
inmuebles<- inmuebles %>% select(CUIT,cantidadinmuebles,zonainmuebles)
##########padron
padron<- read.csv("padron_generoedad.csv", header=T, dec=",", sep=";")
padron<- padron %>% mutate(DNI=substr(ï..CUIT, 3, 15))
padron<- padron %>% mutate(DNI=substr(DNI,1,8))
class(padron$DNI)
padron$DNI<- as.numeric(padron$DNI)
padron2<- padron %>% rename(CUIT=ï..CUIT)
##############################################################################
dniyedades<- read.csv("dniyedades.csv", header=T, sep = ";")
dniencuesta<- read_csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQSkq043ZSTeA5d3Q_E8D-CS-uyzzabQlGTK_Zhq_UENOwCIiDeDn09yYhBsdby4Vvx-xIARnhzXd3q/pub?gid=1734940971&single=true&output=csv")
dniencuesta<- dniencuesta %>% select(-`Marca temporal`)
#########################################################
basejm<- read_excel("basednijm.xlsx")
basejm<- basejm %>% mutate(ldni=log(Docum))
##AcÃ¡ vemos la distribuciÃ³n de los documentos para deterctar los outliers
hist(basejm$Docum)
rm(list=ls())
##Mercado laboral hasta el segundo trimestre 2020
setwd("~/GitHub/mercadolaboral")
library(eph)
library(tidyverse)
#Segundo trimestre 2020
ephi<- get_microdata(year=2020, trimester = 2, type = "individual")
ephh<- get_microdata(year=2020, trimester = 2, type = "hogar")
eph2t<- left_join(ephi, ephh)
#Primer trimestre 2020
ephi<- get_microdata(year=2020, trimester = 1, type = "individual")
ephh<- get_microdata(year=2020, trimester = 1, type = "hogar")
eph1t<- left_join(ephi, ephh)
#Cuarto 2019
ephi<- get_microdata(year=2019, trimester = 4, type = "individual")
ephh<- get_microdata(year=2019, trimester = 4, type = "hogar")
eph4t2019<- left_join(ephi, ephh)
#Tercero 2019
ephi<- get_microdata(year=2019, trimester = 3, type = "individual")
ephh<- get_microdata(year=2019, trimester = 3, type = "hogar")
eph3t2019<- left_join(ephi, ephh)
ephtotal <- bind_rows(eph2t, eph1t, eph4t2019, eph3t2019)
#Quitar duplicados:
ephtotalsd <- ephtotal %>% distinct(., CODUSU, NRO_HOGAR, COMPONENTE, .keep_all = T)
#Empezamos:
#Tasa de participacion laboral:
#Generamos la PEA
ephtotalsd <- ephtotalsd %>%  mutate(PEA= case_when(ESTADO==3 ~ 0,
ESTADO==4 ~ 0,
ESTADO==1 ~ 1,
ESTADO==2 ~ 1),
OCUPADOS= case_when(ESTADO==1 ~ 1,
ESTADO==2 ~ 0,
ESTADO==3 ~ 0,
ESTADO==4 ~ 0),
DESOCUPADOS= case_when(ESTADO==1 ~ 0,
ESTADO==2 ~ 1),
EMPLEADOS= case_when(PP04A==1 ~ "Empleados Publicos",
PP04A==2 ~ "Empleados privados",
PP04A==3 ~ "Otros",
TRUE ~ NA_character_))
#Para comprobar:
table (ephtotalsd$ESTADO, ephtotalsd$PEA)
######Tasa de participacion laboral de la poblacion total #####
#Primero se filtra la base
tablapeapt <- ephtotalsd %>% filter (AGLOMERADO==12 & ESTADO!=0)
#Ahora armamos la tabla (cantidad de 1 sobre cantidad de 0 y 1) y se agrupa entre 0 y 1 (PEA==1), ademas se agrega la cantidad de habitantes dentro de la PEA.
tablapeapt <- tablapeapt %>% group_by(PEA) %>%  summarise((sum(PONDERA)/sum(tablapeapt$PONDERA)), sum(PONDERA), sum(tablapeapt$PONDERA))
tablapeapt
######Tasa de participacion laboral por sexo######
#Primero, se filtra la base:
tablapeasexo<- ephtotalsd %>% filter (AGLOMERADO==12 & ESTADO!=0 & PEA==1)
tablapeasexo <- tablapeasexo %>% group_by(CH04) %>%  summarise(sum(PONDERA), sum(PONDERA)/sum(tablapeasexo$PONDERA))
tablapeasexo
#Proporcion de mujeres que conforman la PEA sobre el total de mujeres:
tablapeamujeres <- ephtotalsd %>%  filter(AGLOMERADO==12 & ESTADO!=0 & CH04==2)
tablapeamujeres <- tablapeamujeres %>% group_by(PEA) %>%  summarise(sum(PONDERA)/sum(tablapeamujeres$PONDERA))
tablapeamujeres
#Proporcion de hombres que conforman la PEA sobre el total de hombres:
tablapeahombres <- ephtotalsd %>%  filter(AGLOMERADO==12 & ESTADO!=0 & CH04==1)
tablapeahombres <- tablapeahombres %>% group_by(PEA) %>% summarise(sum(PONDERA)/sum(tablapeahombres$PONDERA))
tablapeahombres
####Tasa de participacion laboral por edad y sexo #####
#15-24 años
edad15a24 <- ephtotalsd %>% filter(AGLOMERADO==12 & ESTADO!=0 & CH06<=24 & CH06>=15)
#Hombres
hombres <- edad15a24 %>%  filter(CH04==1)
hombres <- hombres %>%  group_by(PEA) %>% summarise(sum(PONDERA)/sum(hombres$PONDERA))
hombres
#Mujeres
mujeres <- edad15a24 %>%  filter(CH04==2)
mujeres <- mujeres %>%  group_by(PEA) %>%  summarise (sum(PONDERA)/sum(mujeres$PONDERA))
mujeres
#25-34 a?os
edad25a34 <- ephtotalsd %>% filter(AGLOMERADO==12 & ESTADO!=0 & CH06<=34 & CH06>=25)
#Hombres
hombres <- edad25a34 %>%  filter(CH04==1)
hombres <- hombres %>%  group_by(PEA) %>% summarise(sum(PONDERA)/sum(hombres$PONDERA))
hombres
#Mujeres
mujeres <- edad25a34 %>%  filter(CH04==2)
mujeres <- mujeres %>%  group_by(PEA) %>%  summarise (sum(PONDERA)/sum(mujeres$PONDERA))
mujeres
#35-44
edad35a44 <- ephtotalsd %>% filter(AGLOMERADO==12 & ESTADO!=0 & CH06<=44 & CH06>=35)
#Hombres
hombres <- edad35a44 %>%  filter(CH04==1)
hombres <- hombres %>%  group_by(PEA) %>% summarise(sum(PONDERA)/sum(hombres$PONDERA))
hombres
#Mujeres
mujeres <- edad35a44 %>%  filter(CH04==2)
mujeres <- mujeres %>%  group_by(PEA) %>%  summarise (sum(PONDERA)/sum(mujeres$PONDERA))
mujeres
#45-59
edad45a59 <- ephtotalsd %>% filter(AGLOMERADO==12 & ESTADO!=0 & CH06<=59 & CH06>=45)
#Hombres
hombres <- edad45a59 %>%  filter(CH04==1)
hombres <- hombres %>%  group_by(PEA) %>% summarise(sum(PONDERA)/sum(hombres$PONDERA))
hombres
#Mujeres
mujeres <- edad45a59 %>%  filter(CH04==2)
mujeres <- mujeres %>%  group_by(PEA) %>%  summarise (sum(PONDERA)/sum(mujeres$PONDERA))
mujeres
#Mayores o iguales a 60 a?os
edad60 <- ephtotalsd %>% filter(AGLOMERADO==12 & ESTADO!=0 & CH06>=60)
#Hombres
hombres <- edad60 %>%  filter(CH04==1)
hombres <- hombres %>%  group_by(PEA) %>% summarise(sum(PONDERA)/sum(hombres$PONDERA))
hombres
#Mujeres
mujeres <- edad60 %>%  filter(CH04==2)
mujeres <- mujeres %>%  group_by(PEA) %>%  summarise (sum(PONDERA)/sum(mujeres$PONDERA))
mujeres
####Tasa de participacion laboral por sexo y nivel educativo####
#Primaria incompleta
primariaincompleta <- ephtotalsd %>%  filter(AGLOMERADO==12 & ESTADO!=0 & NIVEL_ED==1)
#Hombres:
hombres <- primariaincompleta %>%  filter(CH04==1)
hombres <- hombres %>%  group_by(PEA) %>% summarise(sum(PONDERA)/sum(hombres$PONDERA))
hombres
#Mujeres:
mujeres <- primariaincompleta %>%  filter(CH04==2)
mujeres <- mujeres %>%  group_by(PEA) %>% summarise(sum(PONDERA)/sum(mujeres$PONDERA))
mujeres
#Primaria completa
primariacompleta <- ephtotalsd %>%  filter(AGLOMERADO==12 & ESTADO!=0 & NIVEL_ED %in% c(2,3))
#Hombres:
hombres <- primariacompleta %>%  filter(CH04==1)
hombres <- hombres %>%  group_by(PEA) %>% summarise(sum(PONDERA)/sum(hombres$PONDERA))
hombres
#Mujeres:
mujeres <- primariacompleta %>%  filter(CH04==2)
mujeres <- mujeres %>%  group_by(PEA) %>% summarise(sum(PONDERA)/sum(mujeres$PONDERA))
mujeres
#Secundaria incompleta
secundariaincompleta <- ephtotalsd %>%  filter(AGLOMERADO==12 & ESTADO!=0 & NIVEL_ED==3)
#Hombres:
hombres <- secundariaincompleta %>%  filter(CH04==1)
hombres <- hombres %>%  group_by(PEA) %>% summarise(sum(PONDERA)/sum(hombres$PONDERA))
hombres
#Mujeres:
mujeres <- secundariaincompleta %>%  filter(CH04==2)
mujeres <- mujeres %>%  group_by(PEA) %>% summarise(sum(PONDERA)/sum(mujeres$PONDERA))
mujeres
#Secundaria completa
secundariacompleta <- ephtotalsd %>%  filter(AGLOMERADO==12 & ESTADO!=0 & NIVEL_ED %in% c(4,5))
#Hombres:
hombres <- secundariacompleta %>%  filter(CH04==1)
hombres <- hombres %>%  group_by(PEA) %>% summarise(sum(PONDERA)/sum(hombres$PONDERA))
hombres
#Mujeres:
mujeres <- secundariacompleta %>%  filter(CH04==2)
mujeres <- mujeres %>%  group_by(PEA) %>% summarise(sum(PONDERA)/sum(mujeres$PONDERA))
mujeres
#Superior incompleto
superiorincompleto <- ephtotalsd %>%  filter(AGLOMERADO==12 & ESTADO!=0 & NIVEL_ED==5)
#Hombres:
hombres <- superiorincompleto %>%  filter(CH04==1)
hombres <- hombres %>%  group_by(PEA) %>% summarise(sum(PONDERA)/sum(hombres$PONDERA))
hombres
#Mujeres:
mujeres <- superiorincompleto %>%  filter(CH04==2)
mujeres <- mujeres %>%  group_by(PEA) %>% summarise(sum(PONDERA)/sum(mujeres$PONDERA))
mujeres
#Superior completo
superiorcompleto <- ephtotalsd %>%  filter(AGLOMERADO==12 & ESTADO!=0 & NIVEL_ED==6)
#Hombres:
hombres <- superiorcompleto %>%  filter(CH04==1)
hombres <- hombres %>%  group_by(PEA) %>% summarise(sum(PONDERA)/sum(hombres$PONDERA))
hombres
#Mujeres:
mujeres <- superiorcompleto %>%  filter(CH04==2)
mujeres <- mujeres %>%  group_by(PEA) %>% summarise(sum(PONDERA)/sum(mujeres$PONDERA))
mujeres
####Tasa de participacion laboral por sexo y  quintil de ingreso####
#install.packages("Hmisc")
library(Hmisc)
ephcorr <- ephtotalsd %>% filter(AGLOMERADO==12 & ESTADO!=0)
deflactor <- read.csv("deflactor.csv", header=T, sep=";", dec=".")
#deflactor <- read.csv("C:/Users/Bianca/Documents/GitHub/mercadolaboral/deflactor.csv", header=T, sep=";", dec=".")
ephcorr <- left_join(ephcorr, deflactor)
ephcorr <- ephcorr %>%  mutate(IPCFR = IPCF/DEFLACTOR)
ephcorr <- ephcorr %>%  mutate(cuantilp=as.numeric(cut(IPCFR, wtd.quantile(IPCFR, weights = PONDIH, probs = seq(0,1,length=6), na.rm = T), include.lowest = T)))
table(ephcorr$cuantilp)
#ephcorr %>% group_by(cuantilp) %>% summarise(sum(PONDIH))
#ephcorr %>% summarise(IPCFR %*%PONDIH/sum(PONDIH), mean(IPCFR), wtd.mean(IPCFR, weights = PONDIH, na.rm = T) )
#wtd.quantile(ephcorr$IPCFR, weights = ephcorr$PONDIH, probs = seq(0,1,length=6), na.rm = T)
#quantile(ephcorr$IPCFR,probs = seq(0,1,length=6), na.rm=T )
#Quintil 1
quintil1 <- ephcorr %>% filter(cuantilp==1)
#Hombres
hombres <- quintil1 %>%  filter (CH04==1)
hombres <- hombres %>% group_by(PEA) %>% summarise(sum(PONDIH)/sum(hombres$PONDIH))
hombres
#Mujeres
mujeres <- quintil1 %>%  filter (CH04==2)
mujeres <- mujeres %>% group_by(PEA) %>% summarise(sum(PONDIH)/sum(mujeres$PONDIH))
mujeres
#Quintil 2
quintil2 <- ephcorr %>% filter(cuantilp==2)
#Hombres
hombres <- quintil2 %>%  filter (CH04==1)
hombres <- hombres %>% group_by(PEA) %>% summarise(sum(PONDIH)/sum(hombres$PONDIH))
hombres
#Mujeres
mujeres <- quintil2 %>%  filter (CH04==2)
mujeres <- mujeres %>% group_by(PEA) %>% summarise(sum(PONDIH)/sum(mujeres$PONDIH))
mujeres
table(ephcorr$cuantilp)
dim(ephcorr)
#Quintil 3
quintil3 <- ephcorr %>% filter(cuantilp==3)
#Hombres
hombres <- quintil3 %>%  filter (CH04==1)
hombres <- hombres %>% group_by(PEA) %>% summarise(sum(PONDIH)/sum(hombres$PONDIH))
hombres
#Mujeres
mujeres <- quintil3 %>%  filter (CH04==2)
mujeres <- mujeres %>% group_by(PEA) %>% summarise(sum(PONDIH)/sum(mujeres$PONDIH))
mujeres
#Quintil 4
quintil4 <- ephcorr %>% filter(cuantilp==4)
#Hombres
hombres <- quintil4 %>%  filter (CH04==1)
hombres <- hombres %>% group_by(PEA) %>% summarise(sum(PONDIH)/sum(hombres$PONDIH))
hombres
#Mujeres
mujeres <- quintil4 %>%  filter (CH04==2)
mujeres <- mujeres %>% group_by(PEA) %>% summarise(sum(PONDIH)/sum(mujeres$PONDIH))
mujeres
#Quintil 5
quintil5 <- ephcorr %>% filter(cuantilp==5)
#Hombres
hombres <- quintil5 %>%  filter (CH04==1)
hombres <- hombres %>% group_by(PEA) %>% summarise(sum(PONDIH)/sum(hombres$PONDIH))
hombres
#Mujeres
mujeres <- quintil5 %>%  filter (CH04==2)
mujeres <- mujeres %>% group_by(PEA) %>% summarise(sum(PONDIH)/sum(mujeres$PONDIH))
mujeres
####Cantidad de horas trabajadas####
horastrabtotales <- ephtotalsd %>% mutate(horastrabtotales= PP3E_TOT + PP3F_TOT)
#15-24 a?os
horastrab <- horastrabtotales %>% filter (AGLOMERADO==12 & ESTADO!=0 & CH06<=24 & CH06>=15 & !is.na(horastrabtotales))
horastrab <- horastrab %>%  group_by(CH04) %>% summarise(horastrabtotales%*%PONDERA/sum(PONDERA), wtd.mean(horastrabtotales,weights = PONDERA))
horastrab
#25-34
horastrab <- horastrabtotales %>% filter (AGLOMERADO==12 & ESTADO!=0 & CH06<=34 & CH06>=25 & !is.na(horastrabtotales))
horastrab <- horastrab %>%  group_by(CH04) %>% summarise(horastrabtotales%*%PONDERA/sum(PONDERA))
horastrab
#35 a 44
horastrab <- horastrabtotales %>% filter (AGLOMERADO==12 & ESTADO!=0 & CH06<=44 & CH06>=35 & !is.na(horastrabtotales))
horastrab <- horastrab %>%  group_by(CH04) %>% summarise(horastrabtotales%*%PONDERA/sum(PONDERA))
horastrab
#45 a 59
horastrab <- horastrabtotales %>% filter (AGLOMERADO==12 & ESTADO!=0 & CH06<=59 & CH06>=45 & !is.na(horastrabtotales))
horastrab <- horastrab %>%  group_by(CH04) %>% summarise(horastrabtotales%*%PONDERA/sum(PONDERA))
horastrab
#mayores de 60
horastrab <- horastrabtotales %>% filter (AGLOMERADO==12 & ESTADO!=0 & CH06>=60 & !is.na(horastrabtotales))
horastrab <- horastrab %>%  group_by(CH04) %>% summarise(horastrabtotales%*%PONDERA/sum(PONDERA))
horastrab
#Total mujeres y hombres
horastrab <- horastrabtotales %>% filter (AGLOMERADO==12 & ESTADO!=0 & !is.na(horastrabtotales))
horastrab <- horastrab %>%  group_by(CH04) %>% summarise(horastrabtotales%*%PONDERA/sum(PONDERA))
horastrab
#Total de la poblacion
horastrab <- horastrabtotales %>% filter (AGLOMERADO==12 & ESTADO!=0 & !is.na(horastrabtotales))
horastrab <- horastrab %>% summarise(horastrabtotales%*%PONDERA/sum(PONDERA))
horastrab
####Tasa de empleo####
empleo <- ephtotalsd %>% filter(AGLOMERADO==12 & !is.na(OCUPADOS))
empleo <- empleo %>%  group_by(OCUPADOS) %>%  summarise(percent(sum(PONDERA)/sum(empleo$PONDERA), digits = 2))
empleo
####Tasa de desocupacion####
desocupacion <- ephtotalsd %>% filter(AGLOMERADO==12 & !is.na(DESOCUPADOS))
desocupacion <- desocupacion %>%  group_by(DESOCUPADOS) %>%  summarise(sum(PONDERA)/sum(desocupacion$PONDERA))
desocupacion
#Composicion del empleo
####Empleados publicos y privados####
empleados <- ephtotalsd %>% filter(AGLOMERADO==12 & !is.na(EMPLEADOS) & OCUPADOS==1)
table(empleados$EMPLEADOS)
empleados <- empleados %>%  group_by(EMPLEADOS) %>%  summarise(sum(PONDERA))
empleados
empleados <- empleados %>% mutate(proporcion=`sum(PONDERA)`/sum(empleados$`sum(PONDERA)`))
empleados
####Composicion del empleo publico por sexo####
composicionempleados <- ephtotalsd %>% filter(AGLOMERADO==12 & !is.na(EMPLEADOS) & PP04A==1)
composicionempleados <- composicionempleados %>%  group_by(CH04) %>%  summarise(sum(PONDERA))
composicionempleados <- composicionempleados %>% mutate(proporcion=`sum(PONDERA)`/sum(composicionempleados$`sum(PONDERA)`))
composicionempleados
####Composicion del empleo privado por sexo####
composicionempleados <- ephtotalsd %>% filter(AGLOMERADO==12 & !is.na(EMPLEADOS) & PP04A==2)
composicionempleados <- composicionempleados %>%  group_by(CH04) %>%  summarise(sum(PONDERA))
composicionempleados <- composicionempleados %>% mutate(proporcion=`sum(PONDERA)`/sum(composicionempleados$`sum(PONDERA)`))
composicionempleados
####Carga laboral####
#Sector publico
cargalaboralpub <- horastrabtotales %>% filter (AGLOMERADO==12 & ESTADO!=0 & !is.na(horastrwabtotales) & PP04A==1)
cargalaboralpub <- cargalaboralpub %>% summarise(horastrabtotales%*%PONDERA/sum(PONDERA))
cargalaboralpub
#Sector privado
cargalaboralpriv <- horastrabtotales %>% filter (AGLOMERADO==12 & ESTADO!=0 & !is.na(horastrabtotales) & PP04A==2)
cargalaboralpriv <- cargalaboralpriv %>% summarise(horastrabtotales%*%PONDERA/sum(PONDERA))
cargalaboralpriv
####Promedio de edad por sector####
promedioedad<- ephtotalsd %>% filter(AGLOMERADO==12 &  OCUPADOS==1)
promedioedad<- promedioedad %>% group_by(EMPLEADOS) %>% summarise((CH06%*%PONDERA)/sum(PONDERA), wtd.mean(CH06, weights = PONDERA))
promedioedad
####Calificación laboral####
table(ephtotalsd$PP04D_COD)
tab ephtotalsd$PP04B_COD
table ephtotalsd$PP04B_COD
table ephtotalsd$PP04B_COD
table (ephtotalsd$PP04B_COD)
filter (nchar(ephtotalsd$PP04B_COD)<4)
ephtotalsd %>% filter (nchar(PP04B_COD)<4)
ephtotalsd %>% filter (nchar(PP04B_COD)<4) %>% table(PP04B_COD)
caract<- ephtotalsd %>% filter (nchar(PP04B_COD)<4)
table(caract$PP04B_COD)
class(ephtotalsd$PP04B_COD)
caract<- ephtotalsd %>% filter (nchar(PP04B_COD)<4 & PEA==1)
table(caract$PP04B_COD)
caract<- ephtotalsd %>% filter (nchar(PP04B_COD)<4 & OCUPADOS==1)
table(caract$PP04B_COD)
